<html>
<head>
    <meta charset="utf-8"/>
    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>
    <link rel="stylesheet" media="all" href="layout/application.css" data-turbolinks-track="true"/>
    <link rel="stylesheet" media="all" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css"/>
    <style>
        #netDynamisch {
            padding-bottom: 50px;
            -webkit-transform: scale(0.767354368932039, 0.767354368932039);
            transform: scale(0.767354368932039, 0.767354368932039);
            height: 245.553398058252px;
        }

        footer {
            position: relative;
            bottom: 0;
            width: 100%;
        }

        #simulation-buttons {
            margin-right: auto;
            margin-left: auto;
            width: 100%;
        }

        #shock {
            font-size: 150%;
            display: none;
            background-color: #ff0000;
        }

    </style>
</head>
<body>
<div class="bubble_chart" id="bubble_chart"></div>
<div class="warm" style="height:100%;">
    <div id="aira-container-fluid">
        <div class="row" id="aira-controls">
            <div class="input-group">
                <div id="aira-buttons" class="col-md-12"></div>

                <div id="panel" class="col-md-6">
                    <form action="">
                        <label> Prediction </label>
                        <select id='prediction' class="target">
                        </select>

                        <label> Interpolation </label>
                        <select id='interpolation' class="target">
                        </select>

                        <label> Threshold </label>
                        <select id='threshold' class="target">
                        </select>

                        <label> Improvement (percentage) </label>
                        <select id='improvement' class="target">
                        </select>

                        <label> Data </label>
                        <select id='data_select' class="data_select target">
                        </select>
                    </form>
                </div>

                <div id="aira-algorithms" class="col-md-6">
                    <form action="">
                        <div class="checkbox">
                            <label>
                                <input id="chk-threshold" type="checkbox" name="algorithm" value="Threshold"> Threshold
                                estimation
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <input id="chk-stability" type="checkbox" name="algorithm" value="Stability"> Stability
                                estimation
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <input id="chk-frequency" type="checkbox" name="algorithm" value="Frequency"> Frequency
                                estimation
                            </label>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="row aira-result col-md-12">
            <div class="result-item advice col-md-6">
                <h2>Advice</h2>

                <div class="content">
                </div>
            </div>

            <div class="result-item effect col-md-6">
                <h2>Net effect</h2>

                <div class="content">
                </div>
            </div>
        </div>

        <div class="row" style="height:500px">
            <div class="col-md-4">
                <div id="netDynamisch" class="svg-container centered-svg">
                    <div id="shock-div" style="height:30px;"><span id="shock">!SHOCK!</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div id="netFullDynamisch" class="svg-container centered-svg">
                </div>
            </div>
            <div class="col-md-4">
                <div class="bubble_chart" id="bubble_chart"></div>
            </div>
        </div>
        <div class="row">
            <div id="container" style="min-width: 310px; height: 400px;"></div>
            <div id="simulation-buttons">
                <input class="button light button_previous" name="previous" type="button" value="<<<<"
                       id="button_previous"/>
                <input class="button light button_pause" name="pause" type="button" value="||" id="button_pause"/>
                <input class="button light button_play" name="play" type="button" value=">" id="button_play"/>
                <input class="button light button_next" name="next" type="button" value=">>>>" id="button_next"/>
            </div>
        </div>
    </div>
</div>


<script>
    var lags, number_of_variables, aira, simulation, visualization_engine, impulse_response_calculator, view_model;
    var synthetic = false;
    var data;
    var variable_mapping;

    var start_simulation = function (json_data) {
        data_directedNetwerk = json_data[0];
        render_netDynamisch();

        var nodes = $('#netDynamisch').find('g .node');
        var node_names = nodes.map(function (index, node) {
            node_id = node.id;
            node_id = variable_mapping.get_value_from_network(node.id);
            node_id = variable_mapping.get_key(node_id);

            return node_id;
        }).get();
        var data_summary = data_summary_from_json(json_data, node_names);
        var var_coefficients = fullNetworkDataToMatrix(json_data, node_names);
        var_model = new VarModel(var_coefficients, node_names, data_summary,  true, variable_mapping);

        data_directedNetwerk = var_model.to_json();
        render_netDynamisch('#netFullDynamisch');

        injectButtons(node_names);
        simulation = new Simulation(node_names);
        impulse_response_calculator = new ImpulseResponseCalculator(var_model);
        aira = new Aira(impulse_response_calculator, var_model);
        visualization_engine = new Visualization(node_names);

    };

    var main = function (json_data) {
        data = json_data;
        view_model = new ViewModel();
        variable_mapping = new VariableMapping();

        var data_keys = getHgiNetworkJsonKeys(json_data);
        var max_steps = 100;
        var max_interpolation = 500;
        var max_threshold = 1;

        var prediction_select = $('#prediction');
        var interpolation_select = $('#interpolation');
        var threshold_select = $('#threshold');
        var improvement_select = $('#improvement');

        appendSelectOptions(data_keys, '#data_select');
        generateSelectOptions(1, max_steps, 1, '#prediction');
        generateSelectOptions(0, max_interpolation, 1, '#interpolation');
        generateSelectOptions(0, max_threshold, 0.1, '#threshold');
        generateSelectOptions(-100, 100, 1, '#improvement');

        prediction_select.find("option[value='" + (10 > max_steps ? max_steps : 5) + "']").attr('selected', 'selected');
        interpolation_select.find("option[value='" + (25 > max_interpolation ? max_interpolation : 300) + "']").attr('selected', 'selected');
        threshold_select.find("option[value='" + (0.1 > max_threshold ? max_threshold : 0.1) + "']").attr('selected', 'selected');
        improvement_select.find("option[value='10']").attr('selected', 'selected');

        $('body').on("change", ".data_select", function () {
            if (simulation != null) simulation.clear();
            $('#netDynamisch').html('');
            testdataset = data[$('#data_select').val()];
            start_simulation(data[$('#data_select').val()]);
        });
    };

    $(document).ready(function () {
        $.ajax({
            url: "one_network.json",
            type: "GET",
            dataType: 'json',
            error: function (xhr, ajaxOptions, thrownError) {
                console.log(xhr.status);
                console.log(thrownError);
                console.log('Error!');
            },
            success: function (data, text) {
                console.log('Successfully loaded network data');
                main(data);
            }
        });
    });
</script>

<script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js'></script>
<script src='src/bubbleChartVisualization.js'></script>
<script src='src/d3hgi.js'></script>
<script src='src/d3hgi_render.js'></script>
<script src='src/variableMapping.js'></script>
<script src='src/jsonParser.js'></script>
<script src='src/viewModel.js'></script>
<script src='src/varModel.js'></script>
<script src='src/visualization.js'></script>
<script src='src/mathHelpers.js'></script>
<script src='src/variableMapping.js'></script>
<script src='src/impulseResponseCalculator.js'></script>
<script src='src/aira.js'></script>
<script src='src/airaOptimalVariableFinder.js'></script>
<script src='src/simulation.js'></script>
<script src='src/searchers.js'></script>
<script src='src/javascript.js'></script>


</body>
</html>
