var DEBUG=0;function Aira(a,d,e){this.impulse_response_calculator=a;this.var_model=d;this.view_model=e}
Aira.prototype.determineBestNodeFromAll=function(){var a,d,e,f,h={},g={},k=[];for(a=0;a<this.var_model.number_of_variables;a++){f=this.var_model.get_node_name(a);e=f+"_cumulative";d=this.view_model.get_chk_bootstrap();g=this.view_model.get_bootstrap_iterations();d=d?this.impulse_response_calculator.significantImpulseResponseCalculation(a,1,this.view_model.get_steps(),g,.95):transpose(this.impulse_response_calculator.runImpulseResponseCalculation(a,1,this.view_model.get_steps()));g=cumulativeSummation(d);
h[f]=0;for(var l=h[e]=0;l<d.length;l++)l!=a&&(h[e]+=g[l][this.view_model.get_steps()-1]);k.push({name:f,val:h[e]})}return k};
Aira.prototype.determineOptimalNodeSimple=function(a,d,e){var f,h,g,k,l={},p={},q={};variable_to_improve_name=this.var_model.get_node_name(a);0<DEBUG&&console.log("Determining best shock for variable "+a+" (out of "+this.var_model.number_of_variables+")");for(f=0;f<this.var_model.number_of_variables;f++)a!=f&&(k=this.var_model.get_node_name(f),g=k+"_cumulative",h=transpose(this.impulse_response_calculator.runImpulseResponseCalculation(f,1,this.view_model.get_steps())),p=cumulativeSummation(h),l[k]=
h[a],l[g]=p[a],h=new AiraOptimalVariableFinder(l[k],l[g],this.var_model.get_data_summary(variable_to_improve_name),this.var_model.get_data_summary(k),e),q[k]=h.execute(d));if(1<DEBUG){console.log("Effects found for variable: "+a);console.log(q);for(var u in q)if(q.hasOwnProperty(u))for(a=0;a<q[u].length;a++)console.log(u+":"+q[u][a])}return q};
Aira.prototype.determineOptimalNode=function(a,d){var e,f,h,g,k,l,p,q,u={};0<DEBUG&&console.log("Determining best shock for variable "+a+" (out of "+this.var_model.number_of_variables+")");var x=this.getDegradationEffect(d);makeSequenceArray(.1,.1,10);for(e=0;e<this.var_model.number_of_variables;e++)if(a!=e){g={};f=transpose(this.impulse_response_calculator.runImpulseResponseCalculation(e,1,this.view_model.get_steps()));f=f[a];for(p=0;p<this.view_model.get_steps();p++){l=0;h=[];k=0===p?this.view_model.get_steps():
Math.ceil(this.view_model.get_steps()/p);for(j=0;j<k;j++)q=addPadding(f,j*p,0),q=scaleArray(q,x[j]),h.push(q);k=arraySum(h);0===e&&visualization_engine.addData("Sum "+p+" "+this.var_model.node_names[e],k);h=findAllValleys(k);0<h.length&&(h=this.findValleyInMean(k,h,5),0===e&&console.log(h),l=findMinimum(selectionFromArray(k,h)));g[p]=0<l?d.threshold/l:-1}u[this.var_model.node_names[e]]=g}return u};
Aira.prototype.findValleyInMean=function(a,d,e){var f,h,g=[],k=average(selectionFromArray(a,d));for(f=0;f<d.length;f++)h=d[f],Math.abs(k-a[h])<e&&g.push(h);return g};Aira.prototype.getDegradationEffect=function(a){if(a.hasOwnProperty("degradation")&&a.degradation.length==this.view_model.get_steps())return console.log("Using degradation effect"),a.degradation;console.log("NOT Using degradation effect");return makeFilledArray(this.view_model.get_steps(),1)};
Aira.prototype.createAiraNetworkJson=function(a){var d={nodes:[],links:[]};a.forEach(function(a){d.nodes.push({name:variable_mapping.get_translation(a.name),key:a.name,val:a.val})});edges=this.var_model.getSignificantEdges();edges.forEach(function(a){d.links.push({weight:a.coef,distance:.9,source:a.source,target:a.target})});return d};var Optimizers=function(){return{thresholdOptimizer:function(a,d,e){if(!e.hasOwnProperty("threshold"))throw"The threshold option needs to be provided when using the threshold optimizer.";0<DEBUG&&console.log("Optimization using Threshold optimizer (theta = "+e.threshold+")");d=[];var f=-1;for(i=0;i<a.length;i++)a[i]>=e.threshold&&-1==f&&(f=i),a[i]<e.threshold&&-1!=f&&(d.push([f,i-1]),f=-1);return d},netEffectOptimizer:function(a,d,e){var f,h=0,g=0,k=d.length;d=d[k-1];if(.001>Math.abs(d))return{net_effect:Infinity,
sign_switches:Infinity,stability:Infinity,needed_difference:Infinity};var l=e.wanted_increase/100*e.variable_to_improve_summary.average,l=l/d/e.variable_summary.average;for(e=0;e<k;e++)void 0!==f&&(sign(a[e])!=sign(f)&&h++,g++),f=a[e];return{net_effect:d,sign_switches:h,stability:1-h/g,needed_difference:l}},maximumValueOptimizer:function(a,d,e){0<DEBUG&&console.log("Optimization using Maximum optimizer.");return linearSearch(Math.max.apply(null,a),a)}}}(),FinderCommand=function(a,d){this.options=
d;this.execute=a},AiraOptimalVariableFinder=function(a,d,e,f,h){return{execute:function(g){h=void 0===h?g.options:h;h.variable_to_improve_summary=e;h.variable_summary=f;return g.execute(a,d,h)}}},ThresholdOptimizer=function(a){return new FinderCommand(Optimizers.thresholdOptimizer,a)},NetEffectOptimizer=function(a){return new FinderCommand(Optimizers.netEffectOptimizer,a)},MaximumValueOptimizer=function(a){return new FinderCommand(Optimizers.maximumValueOptimizer,a)};var BubbleChartVisualization=function(){function a(a,d){var e=a.determineBestNodeFromAll();f=a.createAiraNetworkJson(e);h=d}var d=999999,e=-99999,f,h,g=d3.layout.force().charge(-1E4).linkDistance(100).linkStrength(function(a){return a.distance}).friction(.9).gravity(.1).theta(.1).size([400,400]),k=d3.select("#bubble_chart").append("svg").attr("class","bubble_chart_svg").attr("width",400).attr("height",400),l=function(){var a;f.nodes.forEach(function(g){a=Math.log(1+Math.abs(g.val));d=d<a?d:a;e=e>
a?e:a})},p=function(a){return 0===a.val?5:(Math.log(1+Math.abs(a.val))-d)/(e-d)*35+5},q=function(a,d,e){-1==Math.sign(a.val)&&(d=e);return d+a.name.toLowerCase()},u=function(a){a.selectAll("*").remove();d=999999;e=-99999},x=function(a,d){void 0===a&&(a={index:-1});f.nodes.forEach(function(e){k.select("#label_"+e.key).text(e.index==a.index||d?q(e,"More ","Less "):e.name)})},v=function(a){var d="";if(1==a.length)d="Whenever you experience "+a[0]+", youre well-being will be increased the next moment. However, this does not have a significant effect on the other variables.";
else for(var d=d+("Whenever you experience "+a[0]+", the next moment you'll experience  "),e=1;e<a.length;e++)d=2==a.length?d+(a[e]+"."):e==a.length-1?d+("and "+a[e]+"."):d+(a[e]+", ");d3.select("#effect_list").select("span").append("span").text(d)},y=function(a){var d=[];d.push(q(a,"more ","less "));f.links.forEach(function(e){if(e.source.index==a.index){var g=f.nodes.filter(function(a){return a.index==e.target.index}).map(function(d){return{val:Math.sign(e.weight*a.val),key:d.key,name:d.name}})[0];
k.select("#label_"+g.key).text(function(a){return q(g,"More ","Less ")});d.push(q(g,"More ","Less "))}});v(d)},D=function(a){k.selectAll("line").filter(function(d){return d.source.index===a.index}).classed("visible-line-click",function(a){return!d3.select(this).classed("visible-line-click")})},m=function(a){var d=d3.select(this),e=d.classed("selected_node");u(d3.select("#effect_list").select("span"));u(d3.select("#percentage_advice").select("span"));k.selectAll("line").classed("visible-line-click",
!1);k.selectAll("line").classed("visible-line-hover",!1);k.selectAll(".node").style("stroke-width","0px").style("stroke","#fff").classed("selected_node",!1);x(a,e);if(!e){d.style("stroke-width","2px").style("stroke","#ff0000").classed("selected_node",!0);D(a);y(a);var d=0<=Math.sign(a.val)?10:-10,e=0,g="",f=aira.determineOptimalNodeSimple(a.index,h,{wanted_increase:d}),t=0,E;for(E in f)current=100*f[E].needed_difference,console.log(f[E].needed_difference),-100>current||Infinity===f[E].needed_difference||
(e+=1,g+=(1<e?", ":" ")+((0<current?"increase":"decrease")+" your average amount of '"+E+"' with "+Math.abs(current.toFixed(0))+"%"),t++);g=0<t?"In order to "+(0<=Math.sign(a.val)?"increase":"decrease")+" '"+a.name+"' with "+Math.abs(d)+"%, you could "+g:"We could not determine a suitable way to "+(0<=Math.sign(a.val)?"increase":"decrease")+" '"+a.name+"' with "+Math.abs(d)+"%.";d3.select("#percentage_advice").select("span").append("span").text(g)}},n=function(a){k.selectAll("line").classed("visible-line-hover",
!1)},w=function(a){k.selectAll("line").filter(function(d){return d.source.index===a.index}).classed("visible-line-hover",!0)},A=function(a){return f.nodes.filter(function(d){return d.index===a})[0]};a.prototype.render=function(){u(k);l();g.nodes(f.nodes).links(f.links);k.append("svg:defs").selectAll("marker").data(f.links).enter().append("svg:marker").attr("id",function(a){return"arrow-head-"+a.source.index+"-"+a.target.index}).attr("viewBox","0 -5 10 10").attr("refX",function(a){return.6*p(A(a.target.index))/
Math.sqrt(2)+10}).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").attr("fill","#666").append("svg:path").attr("d","M0,-5L10,0L0,5");var a=k.selectAll(".link").data(f.links).enter().append("line").attr("class","line").style("stroke","#B8CEB3").attr("fill","none").style("stroke-width",function(a){return 4}).attr("marker-end",function(a){return"url(#arrow-head-"+a.source.index+"-"+a.target.index+")"}),d=k.selectAll(".node").data(f.nodes).enter().append("circle").attr("class",
"node").attr("r",p).style("fill","#3397da").on({mouseenter:w,mouseout:n,click:m}),e=k.selectAll(".text").data(f.nodes).enter().append("text").attr("x",8).attr("y",".41em").attr("id",function(a){return"label_"+a.key}).style("text-anchor","middle").text(function(a){return q(a,"More ","Less ")});g.start();var h,F,t,E;g.on("tick",function(){a.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}).style("stroke",
"#999");F=h=1E4;E=t=-1E4;f.nodes.forEach(function(a){a.x<h&&(h=a.x);a.x>t&&(t=a.x);a.y<F&&(F=a.y);a.y>E&&(E=a.y)});f.nodes.forEach(function(a){.05<t-h&&(a.x=100+200*(a.x-h)/(t-h));.05<E-F&&(a.y=100+200*(a.y-F)/(E-F))});d.attr("cx",function(a){a.x=Math.max(p(a),Math.min(400-p(a),a.x));return a.x}).attr("cy",function(a){a.y=Math.max(p(a),Math.min(400-p(a),a.y));return a.y});e.attr("x",function(a){return a.x}).attr("y",function(a){return 200<a.y?a.y+p(a)+20:a.y-p(a)-3})});for(var C=0;400>C;C++)g.tick()};
return a}();var DEBUG=!1,formatCount=d3.format(",.0f"),hasOwnProperty=Object.prototype.hasOwnProperty;function isEmpty(a){if(null==a)return!0;if(0<a.length)return!1;if(0===a.length)return!0;for(var d in a)if(hasOwnProperty.call(a,d))return!1;return!0}function sortByKey(a,d){return a.sort(function(a,f){var h=a[d],g=f[d];return h<g?-1:h>g?1:0})}function angle(a){a=90*(a.startAngle+a.endAngle)/Math.PI-90;return 90<a?a-180:a}var seed=17;function random(){var a=1E4*Math.sin(seed++);return a-Math.floor(a)}
function generate_id(a){a=a.toLowerCase();a=a.replace(/ /g,"_");return a=a.replace(/\./g,"_")}
function hgiNetwork(){function a(a){a.each(function(z){function J(){D&&(z.nodes[O.index].x=e/2,z.nodes[O.index].y=f/2,z.nodes[O.index].charge=0);var a=1E4,d=1E4,g=-1E4,h=-1E4;z.nodes.forEach(function(e){0>=e.weight&&(e.charge=-30);e.x<a&&(a=e.x);e.x>g&&(g=e.x);e.y<d&&(d=e.y);e.y>h&&(h=e.y)});z.nodes.forEach(function(C){.05<g-a&&(C.x=e*(C.x-a)/(g-a));.05<h-d&&(C.y=f*(C.y-d)/(h-d))});w&&!m&&E.start();L.selectAll("line").attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",
function(a){return a.target.x}).attr("y2",function(a){return a.target.y});K.selectAll("path.arclink").attr("d",U);A&&(DEBUG&&L.selectAll("circle").attr("transform",function(a){!G&&a.source.weight<a.target.weight?(targetRadius=a.source.radius,targetX=a.source.x,targetY=a.source.y,fromX=a.target.x,fromY=a.target.y):(targetRadius=a.target.radius,targetX=a.target.x,targetY=a.target.y,fromX=a.source.x,fromY=a.source.y,console.log("called.."));maxDistance=B+targetRadius;diffX=fromX-targetX;diffY=fromY-
targetY;distance=Math.sqrt(diffX*diffX+diffY*diffY);a.x=targetX+diffX/distance*maxDistance;a.y=targetY+diffY/distance*maxDistance;coefMarkerOffsetRad=I*Math.PI/180;transX=a.x-targetX;transY=a.y-targetY;a.x=targetX+(transX*Math.cos(coefMarkerOffsetRad)-transY*Math.sin(coefMarkerOffsetRad));a.y=targetY+(transX*Math.sin(coefMarkerOffsetRad)+transY*Math.cos(coefMarkerOffsetRad));return"translate("+a.x+","+a.y+")"}),L.selectAll("text").attr("transform",function(a){!G&&a.source.weight<a.target.weight?(targetRadius=
a.source.radius,targetX=a.source.x,targetY=a.source.y,fromX=a.target.x,fromY=a.target.y):(targetRadius=a.target.radius,targetX=a.target.x,targetY=a.target.y,fromX=a.source.x,fromY=a.source.y);maxDistance=B+targetRadius;diffX=fromX-targetX;diffY=fromY-targetY;distance=Math.sqrt(diffX*diffX+diffY*diffY);a.x=targetX+diffX/distance*maxDistance;a.y=targetY+diffY/distance*maxDistance;coefMarkerOffsetRad=I*Math.PI/180;transX=a.x-targetX;transY=a.y-targetY;a.x=targetX+(transX*Math.cos(coefMarkerOffsetRad)-
transY*Math.sin(coefMarkerOffsetRad));a.y=targetY+(transX*Math.sin(coefMarkerOffsetRad)+transY*Math.cos(coefMarkerOffsetRad));return"translate("+a.x+","+a.y+")"}),K.selectAll("text").attr("transform",function(a){!G&&a.source.weight<a.target.weight?(targetRadius=a.source.radius,targetX=a.source.x,targetY=a.source.y,fromX=a.target.x,fromY=a.target.y):(targetRadius=a.target.radius,targetX=a.target.x,targetY=a.target.y,fromX=a.source.x,fromY=a.source.y);maxDistance=B+targetRadius;diffX=fromX-targetX;
diffY=fromY-targetY;distance=Math.sqrt(diffX*diffX+diffY*diffY);a.x=targetX+diffX/distance*maxDistance;a.y=targetY+diffY/distance*maxDistance;coefMarkerOffsetRad=I*Math.PI/180;transX=a.x-targetX;transY=a.y-targetY;a.x=targetX+(transX*Math.cos(coefMarkerOffsetRad)-transY*Math.sin(coefMarkerOffsetRad));a.y=targetY+(transX*Math.sin(coefMarkerOffsetRad)+transY*Math.cos(coefMarkerOffsetRad));return"translate("+a.x+","+a.y+")"}));G&&(L.selectAll(".arrow").attr("transform",function(a){maxDistance=B+targetRadius;
var d=Math.atan((a.target.y-a.source.y)/(a.target.x-a.source.x)),e=1-(a.width-x)/v;a.x=a.source.x+(.95+.05*e)*(Math.cos(d)*a.source.radius+.5*(a.target.x-a.source.x-Math.cos(d)*a.source.radius-Math.cos(d)*a.target.radius));a.y=a.source.y+(.95+.05*e)*(Math.sin(d)*a.source.radius+.5*(a.target.y-a.source.y-Math.sin(d)*a.source.radius-Math.sin(d)*a.target.radius));orient=Math.atan((a.target.y-a.source.y)/(a.target.x-a.source.x));orientdeg=180*orient/Math.PI;a.target.x<a.source.x?orientdeg-=180:0;return"translate("+
a.x+","+a.y+") rotate("+orientdeg+") scale("+(1+(a.width-x)/(2*(v-x)))+")"}),K.select(".arrow").attr("transform",function(a,d){var e=K.select("path.arclink")[0][d].getTotalLength()/2;midPoint=K.select("path.arclink")[0][d].getPointAtLength(e);orient=Math.atan((a.target.y-a.source.y)/(a.target.x-a.source.x));orientdeg=180*orient/Math.PI;a.target.x<a.source.x?orientdeg-=180:0;return"translate("+midPoint.x+","+midPoint.y+") rotate("+orientdeg+") scale("+(1+(a.width-x)/(2*(v-x)))+")"}));P.selectAll(".node").attr("cx",
function(a){return a.x}).attr("cy",function(a){return a.y});H&&P.selectAll(".nodeGrad").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y})}function Q(){R.each(function(a,d){0==d%2?(a.x=a.node.x,a.y=a.node.y):(diffX=a.x-a.node.x,diffY=a.y-a.node.y,distance=Math.sqrt(diffX*diffX+diffY*diffY),maxDistance=u+a.node.radius,a.x=a.node.x+diffX/distance*maxDistance,a.y=a.node.y+diffY/distance*maxDistance,0<diffX?0<diffY?a.side="bottomright":a.side="topright":0<diffY?a.side="bottomleft":
a.side="topleft")});V.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y});R.attr("transform",function(a){return"translate("+a.x+","+a.y+")"});R.selectAll("text").attr("dy",function(a){if("topleft"==a.side||"topright"==a.side)return"-0.1em";if("bottomleft"==a.side||"bottomright"==a.side)return"0.4em"}).attr("text-anchor",function(a){if("topleft"==a.side)return"end";if("topright"==a.side)return"start";
if("bottomleft"==a.side)return"end";if("bottomright"==a.side)return"start"})}function U(a){var d=a.target.x-a.source.x,e=a.target.y-a.source.y,d=Math.sqrt(d*d+e*e);return"M"+a.source.x+","+a.source.y+"A"+d+","+d+" 0 0,1 "+a.target.x+","+a.target.y}if(!isEmpty(z.nodes)){if(isEmpty(z.links))var T=!0;DEBUG&&(console.log("--hgiNetwork"),console.log("properties:"),console.log({margin:d,size:[e,f],mapping:h,xDomain:0,yDomain:0,addLabels:y}),console.log("selection:"),console.log(a),console.log("data:"),
console.log(z));0==g&&(g=Math.min(f/4,e/4));t.linkDistance(function(a,d){return 2==a.source.weight||2==a.target.weight?g/2:1==a.source.weight||1==a.target.weight?g/3:g}).nodes(z.nodes).links(z.links).linkStrength(function(a,d){return k}).charge(function(a,d){DEBUG&&console.log("Charge:"+-50*a.radius*a.radius);return F?-50*a.radius*a.radius:l}).friction(q).gravity(p).size([e,f]).on("tick",J).start();var O=z.nodes[0];z.nodes.forEach(function(a){a.weight>O.weight?O=a:0});z.nodes.forEach(function(a){a.px=
Math.floor(random()*e);a.py=Math.floor(random()*f);a.x=a.px;a.y=a.py;DEBUG&&console.log("Node:"+a.name+" ("+a.x+","+a.y+")")});if(w){z.labelNodes=[];z.nodes.forEach(function(a){z.labelNodes.push({node:a});z.labelNodes.push({node:a})});z.labelLinks=[];for(var M=0;M<z.nodes.length;M++)z.labelLinks.push({source:2*M,target:2*M+1,weight:1});E.nodes(z.labelNodes).links(z.labelLinks).gravity(0).linkDistance(1).linkStrength(8).charge(-250).on("tick",Q).size([e,f]);DEBUG&&(console.log("Generated force based label network:"),
console.log(z.labelNodes),console.log(z.labelLinks),console.log(""))}t.start();w?E.start():0;var M=d3.select(this).selectAll("svg").data([z]),N=M.enter().append("svg").append("g").attr("class","network");if(H){var S=M.append("defs").append("radialGradient").attr("id","nodeGrad").attr("cx","30%").attr("cy","30%").attr("r","55%");S.append("stop").attr("offset","0%").style("stop-color","white").attr("stop-opacity","1.0");S.append("stop").attr("offset","5%").style("stop-color","white").attr("stop-opacity",
"1.0");S.append("stop").attr("offset","100%").style("stop-color","white").attr("stop-opacity","0.0")}M.attr({width:e+d.left+d.right,height:f+d.top+d.bottom});N=M.select("g").attr("transform","translate("+d.left+","+d.top+")");L=N.selectAll(".link");K=N.selectAll(".arclink");if(!T){G&&z.links.forEach(function(a){a.doubly=!1;z.links.forEach(function(d){d.target==a.source&&d.source==a.target?a.doubly=!0:0})});var L=L.data(z.links.filter(function(a){if(!G||0==a.doubly)return a})).enter().append("g").attr("class",
"link");if(G)var K=K.data(z.links.filter(function(a){if(1==a.doubly)return a})).enter().append("g").attr("class","link");A&&(L.append("text").attr("text-anchor","middle").attr("dy","0.3em").attr("class",function(a){return 0<a.coef?"positive":"negative"}).text(function(a){0<a.coef?a.coefSign="+":a.coefSign="-";return a.coefSign}),K.append("text").attr("text-anchor","middle").attr("dy","0.3em").attr("class",function(a){return 0<a.coef?"positive":"negative"}).text(function(a){0<a.coef?a.coefSign="+":
a.coefSign="-";return a.coefSign}));L.append("line").style("stroke-width",function(a){a.width=x+Math.min(v,v*Math.max(0,2*(Math.abs(a.coef)-.2)));return a.width+"px"});G&&K.append("path").attr("class","arclink").style("stroke-width",function(a){a.width=x+Math.min(v,v*Math.max(0,2*(Math.abs(a.coef)-.2)));return a.width+"px"});G&&(L.append("path").attr("class","arrow").attr("d",function(a){return"M0,-5L10,0L0,5"}),K.append("path").attr("class","arrow").attr("d",function(a){return"M0,-5L10,0L0,5"}))}var P=
N.selectAll(".node").data(z.nodes).enter().append("g");P.append("circle").attr("class",function(a){return"node "+a.type}).attr("id",function(a){return generate_id(a.name)}).attr("r",function(a){a.radius=T?15:10+a.weight/O.weight*10;return a.radius});H||P.append("circle").attr("class","nodeGrad").attr("r",function(a){return a.radius}).style("fill","url(#nodeGrad)");if(w){var V=N.selectAll(".labelLink").data(z.labelLinks),R=N.selectAll(".labelNode").data(z.labelNodes).enter().append("g").attr("class",
"labelNode");R.append("circle").attr("r",0).style("fill","#000");R.append("text").text(function(a,d){return 0==d%2?"":a.node.name})}if(n){P.call(t.drag);t.drag().on("dragstart",function(a){d3.select(this).classed("fixed",a.fixed=!0)});if(w)t.drag().on("drag",function(){E.resume()});P.on("dblclick",function(a){d3.select(this).classed("fixed",a.fixed=!1)})}m?(N.attr("visibility","hidden"),setTimeout(function(){if(DEBUG)var a=(new Date).getTime();t.start();for(var d=100;0<d;--d)t.tick();t.stop();if(w){E.start();
for(d=100;0<d;--d)E.tick();E.stop()}N.attr("visibility",null);DEBUG&&(d=(new Date).getTime(),console.log("Simulation time: "+(d-a)+"ms"))},10)):t.start()}})}var d={top:70,right:130,bottom:40,left:130},e=255,f=210,h=["links","nodes"],g=200,k=1,l=-1E4,p=.1,q=.8,u=5,x=2,v=7,y=!0,D=!1,m=!0,n=!0,w=!0,A=!0,B=7,I=12,G=!1,H=!0,F=!1,t=d3.layout.force(),E=d3.layout.force();a.margin=function(e){if(!arguments.length)return d;d=e;return a};a.width=function(d){if(!arguments.length)return e;e=d;return a};a.height=
function(d){if(!arguments.length)return f;f=d;return a};a.mapping=function(d){if(!arguments.length)return h;h=d;return a};a.addLabels=function(d){if(!arguments.length)return y;y=d;return a};a.doCenterNode=function(d){if(!arguments.length)return D;D=d;return a};a.doStaticLayout=function(d){if(!arguments.length)return m;m=d;return a};a.linkDistance=function(d){if(!arguments.length)return g;g=d;return a};a.linkStrength=function(d){if(!arguments.length)return k;k=d;return a};a.charge=function(d){if(!arguments.length)return l;
l=d;return a};a.labelDistance=function(d){if(!arguments.length)return u;u=d;return a};a.gravity=function(d){if(!arguments.length)return p;p=d;return a};a.friction=function(d){if(!arguments.length)return q;q=d;return a};a.minStrokeWidth=function(d){if(!arguments.length)return x;x=d;return a};a.maxStrokeWidth=function(d){if(!arguments.length)return v;v=d;return a};a.addLabels=function(d){if(!arguments.length)return y;y=d;return a};a.doCenterNode=function(d){if(!arguments.length)return D;D=d;return a};
a.allowDragging=function(d){if(!arguments.length)return n;n=d;return a};a.doForceBasedLabels=function(d){if(!arguments.length)return w;w=d;return a};a.addCoefficientMarkers=function(d){if(!arguments.length)return A;A=d;return a};a.coefMarkerDistance=function(d){if(!arguments.length)return B;B=d;return a};a.coefMarkerOffset=function(d){if(!arguments.length)return I;I=d;return a};a.isDirectedGraph=function(d){if(!arguments.length)return G;G=d;return a};a.addGradients=function(d){if(!arguments.length)return H;
H=d;return a};a.doWeightedCharge=function(d){if(!arguments.length)return F;F=d;return a};return a}
function hgiPie(){function a(a){a.each(function(n){DEBUG&&(console.log("--hgiPie"),console.log("properties:"),console.log({margin:d,size:[e,f],mapping:h,xDomain:0,yDomain:0,addLabels:k}),console.log("selection:"),console.log(a),console.log("data:"),console.log(n));n=sortByKey(n,"meetmoment");n=n.map(function(a,d){return[y.call(n,a,d),D.call(n,a,d)]});DEBUG&&(console.log("mapped data:"),console.log(n));pieSum=0;x.value(function(a){pieSum+=a[1];return a[1]}).sort(null);v.innerRadius(p).outerRadius(q);
var w=d3.select(this).selectAll("svg").data([n]),A=w.enter().append("svg").append("g");A.append("g").attr("class","pie");w.attr({width:e+d.left+d.right,height:f+d.top+d.bottom});A=w.select("g").attr("transform","translate("+(e+d.left+d.right)/2+","+(f+d.top+d.bottom)/2+")");w=w.select(".pie").selectAll(".arc").data(x(n)).enter();w.append("g").attr("class","arc").append("path").attr("d",v).style("fill",function(a){return u(a.data[0])});g&&w.append("text").attr("class","legend").attr("transform",function(a){var d=
v.centroid(a);return"translate("+l*d[0]+","+l*d[1]+") rotate("+angle(a)+")"}).attr("text-anchor",function(a){return 0<v.centroid(a)[0]?"start":"end"}).text(function(a,d){return n[d][0]});k&&w.append("text").attr("class","label").attr("transform",function(a){return"translate("+v.centroid(a)+")"}).text(function(a){return a.data[1]})})}var d={top:30,right:30,bottom:30,left:30},e=510,f=515,h=["x","y"],g=!0,k=!0,l=1.6,p=60,q=150,u=d3.scale.category20(),x=d3.layout.pie(),v=d3.svg.arc(),y=function(a){return a[h[0]]},
D=function(a){return a[h[1]]};a.margin=function(e){if(!arguments.length)return d;d=e;return a};a.width=function(d){if(!arguments.length)return e;e=d;return a};a.height=function(d){if(!arguments.length)return f;f=d;return a};a.mapping=function(d){if(!arguments.length)return h;h=d;return a};a.innerRadius=function(d){if(!arguments.length)return p;p=d;return a};a.outerRadius=function(d){if(!arguments.length)return q;q=d;return a};a.legend=function(d){if(!arguments.length)return legend;legend=d;return a};
a.pieColor=function(d){if(!arguments.length)return u;u=d;return a};a.addLabels=function(d){if(!arguments.length)return k;k=d;return a};a.addLegends=function(d){if(!arguments.length)return g;g=d;return a};a.offsetLegends=function(d){if(!arguments.length)return l;l=d;return a};return a}
function hgiScatter(){function a(a){a.each(function(B){DEBUG&&(console.log("--hgiScatter"),console.log("properties:"),console.log({margin:d,size:[e,f],mapping:h,xDomain:g,yDomain:k,addLOESS:l}),console.log("selection:"),console.log(a),console.log("data:"),console.log(B));B=sortByKey(B,"meetmoment");l&&(B=sortByKey(B,h[0]));B=B.map(function(a,d){return[n.call(B,a,d),w.call(B,a,d)]});DEBUG&&(console.log("mapped data:"),console.log(B));minX=d3.min(B,function(a){return a[0]});maxX=d3.max(B,function(a){return a[0]});
margeX=(maxX-minX)/20;minY=d3.min(B,function(a){return a[1]});maxY=d3.max(B,function(a){return a[1]});margeY=(maxY-minY)/20;0==g?v.domain([minX-margeX,maxX+margeX]):v.domain(g);0==k?y.domain([minY-margeY,maxY+margeY]):y.domain(k);v.range([0,e-d.left-d.right]);y.range([f-d.top-d.bottom,0]);void 0!=typeof p&&D.ticks(p);void 0!=typeof q&&m.ticks(q);var I=d3.select(this).selectAll("svg").data([B]),G=I.enter().append("svg").append("g").attr("class","scatter");G.append("g").attr("class","dots");G.append("g").attr("class",
"x axis");G.append("g").attr("class","y axis");I.attr({width:e,height:f});G=I.select("g").attr("transform","translate("+d.left+","+d.top+")");G.select(".dots").selectAll(".dot").data(B.filter(function(a){return isNaN(a[0])||isNaN(a[1])||null==a[0]||null==a[1]?0:1})).enter().append("circle").attr("class","bubble").attr("cx",function(a){return v(a[0])}).attr("cy",function(a){return y(a[1])}).attr("r",3.5);l&&G.append("path").datum(function(){var a=science.stats.loess();a.bandwidth(.7);var d=B.filter(function(a){return isNaN(a[0])||
isNaN(a[1])||null==a[0]||null==a[1]?0:1}),e=d.map(function(a){return v(a[0])}),d=d.map(function(a){return y(a[1])}),a=a(e,d);return d3.zip(e,a)}).attr("class","line").attr("d",d3.svg.line().interpolate("basis").x(function(a){return a[0]}).y(function(a){return a[1]}));"function"==typeof D&&(G.select(".x.axis").attr("transform","translate(0,"+(f-d.top-d.bottom)+")").call(D),void 0!=typeof u&&G.select(".x.axis").append("text").attr("x",(e-d.left-d.right)/2).attr("y",d.bottom).attr("dy","-0.2em").style("text-anchor",
"middle").text(u));"function"==typeof m&&(G.select(".y.axis").call(m),void 0!=typeof u&&G.select(".y.axis").append("text").attr("transform","rotate(-90)").attr("x",0-(f-d.bottom-d.top)/2).attr("y",0-d.left).attr("dy","1em").style("text-anchor","middle").text(x))})}var d={top:20,right:20,bottom:40,left:50},e=425,f=415,h=["x","y"],g=0,k=0,l=!1,p,q,u,x,v=d3.scale.linear(),y=d3.scale.linear(),D=d3.svg.axis().scale(v).orient("bottom"),m=d3.svg.axis().scale(y).orient("left"),n=function(a){return a[h[0]]},
w=function(a){return a[h[1]]};a.margin=function(e){if(!arguments.length)return d;d=e;return a};a.width=function(d){if(!arguments.length)return e;e=d;return a};a.height=function(d){if(!arguments.length)return f;f=d;return a};a.mapping=function(d){if(!arguments.length)return h;h=d;return a};a.xDomain=function(d){if(!arguments.length)return g;g=d;return a};a.yDomain=function(d){if(!arguments.length)return k;k=d;return a};a.legend=function(d){if(!arguments.length)return legend;legend=d;return a};a.xAxis=
function(d){if(!arguments.length)return D;D=d;return a};a.yAxis=function(d){if(!arguments.length)return m;m=d;return a};a.addLOESS=function(d){if(!arguments.length)return l;l=d;return a};a.xTicks=function(d){if(!arguments.length)return p;p=d;return a};a.yTicks=function(d){if(!arguments.length)return q;q=d;return a};a.xLabel=function(d){if(!arguments.length)return u;u=d;return a};a.yLabel=function(d){if(!arguments.length)return x;x=d;return a};return a}
function hgiBubble(){function a(a){a.each(function(H){DEBUG&&(console.log("--hgiBubble"),console.log("properties:"),console.log({margin:d,size:[e,f],mapping:h,weightMapping:g,xDomain:k,yDomain:l,addLabels:p,orderBubbles:q}),console.log("selection:"),console.log(a),console.log("data:"),console.log(H));H=sortByKey(H,"meetmoment");q&&(H=sortByKey(H,h[0]));H=H.map(function(a,d){return[A.call(H,a,d),B.call(H,a,d),I.call(H,a,d)]});DEBUG&&(console.log("mapped data:"),console.log(H));0==k?D.domain([0,d3.max(H,
function(a){return a[0]})]):D.domain(k);0==l?m.domain(H.map(function(a){return a[1]})):m.domain(l);D.range([0,e-d.left-d.right]);m.rangeRoundBands([0,f-d.top-d.bottom],.2);void 0!=typeof u&&"function"==typeof n&&n.ticks(u);void 0!=typeof x&&"function"==typeof w&&w.ticks(x);var F=d3.select(this).selectAll("svg").data([H]),t=F.enter().append("svg").append("g");t.append("g").attr("class","bubbles");t.append("g").attr("class","x axis");t.append("g").attr("class","y axis");F.attr({width:e,height:f});t=
F.select("g").attr("transform","translate("+d.left+","+d.top+")");F=t.select(".bubbles").selectAll(".bubble").data(H).enter();F.append("circle").attr("class","bubble").attr("cx",function(a){return D(a[0])}).attr("cy",function(a){return m(a[1])+m.rangeBand()/2}).attr("r",function(a){return 7+4*a[2]});p&&F.append("text").attr("class","label").attr("y",function(a){return m(a[1])+m.rangeBand()/2+4}).attr("x",function(a){return D(a[0])-(7+4*a[2])-4}).attr("text-anchor","end").text(function(a){return a[1]});
"function"==typeof n&&(t.select(".x.axis").attr("transform","translate(0,"+(f-d.top-d.bottom)+")").call(n),void 0!=typeof v&&t.select(".x.axis").append("text").attr("x",(e-d.left-d.right)/2).attr("y",d.bottom).attr("dy","-0.2em").style("text-anchor","middle").text(v));"function"==typeof w&&(t.select(".y.axis").call(w),void 0!=typeof y&&t.select(".y.axis").append("text").attr("transform","rotate(-90)").attr("x",0-(f-d.bottom-d.top)/2).attr("y",0-d.left).attr("dy","1em").style("text-anchor","middle").text(y))})}
var d={top:0,right:15,bottom:40,left:40},e=515,f=515,h=["x","y"],g=["weight"],k=0,l=0,p=!0,q=!0,u,x,v,y,D=d3.scale.linear(),m=d3.scale.ordinal(),n=d3.svg.axis().scale(D).orient("bottom"),w=d3.svg.axis().scale(m).orient("left"),A=function(a){return a[h[0]]},B=function(a){return a[h[1]]},I=function(a){return a[g]};a.margin=function(e){if(!arguments.length)return d;d=e;return a};a.width=function(d){if(!arguments.length)return e;e=d;return a};a.height=function(d){if(!arguments.length)return f;f=d;return a};
a.mapping=function(d){if(!arguments.length)return h;h=d;return a};a.weightMapping=function(d){if(!arguments.length)return g;g=d;return a};a.xDomain=function(d){if(!arguments.length)return k;k=d;return a};a.yDomain=function(d){if(!arguments.length)return l;l=d;return a};a.legend=function(d){if(!arguments.length)return legend;legend=d;return a};a.xAxis=function(d){if(!arguments.length)return n;n=d;return a};a.yAxis=function(d){if(!arguments.length)return w;w=d;return a};a.addLabels=function(d){if(!arguments.length)return p;
p=d;return a};a.orderBubbles=function(d){if(!arguments.length)return q;q=d;return a};a.xTicks=function(d){if(!arguments.length)return u;u=d;return a};a.yTicks=function(d){if(!arguments.length)return x;x=d;return a};a.xLabel=function(d){if(!arguments.length)return v;v=d;return a};a.yLabel=function(d){if(!arguments.length)return y;y=d;return a};return a}
function hgiBar(){function a(a){a.each(function(g){DEBUG&&(console.log("--hgiBar"),console.log("properties:"),console.log({margin:d,size:[e,f],mapping:h,xDomain:l,yDomain:p,addLabels:q,addError:u}),console.log("selection:"),console.log(a),console.log("data:"),console.log(g));g=sortByKey(g,"meetmoment");g=g.map(function(a,d){return u?x?[G.call(g,a,d),H.call(g,a,d),F.call(g,a,d),t.call(g,a,d)]:[G.call(g,a,d),H.call(g,a,d),F.call(g,a,d)]:x?[G.call(g,a,d),H.call(g,a,d),t.call(g,a,d)]:[G.call(g,a,d),H.call(g,
a,d)]});DEBUG&&(console.log("mapped data:"),console.log(g));0==l?w.domain([0,d3.max(g,function(a){return a[1]})]):w.domain(l);0==p?A.domain(g.map(function(a){return a[0]})):A.domain(p);w.range([0,e-d.left-d.right]);A.rangeRoundBands([f-d.top-d.bottom,0],.2);void 0!=typeof v&&B.ticks(v);void 0!=typeof y&&I.ticks(y);var k=d3.select(this).selectAll("svg").data([g.filter(function(a){return isNaN(a[1])||0==a[1]?0:1})]),J=k.enter().append("svg").append("g");J.append("g").attr("class","bars");J.append("g").attr("class",
"x axis");J.append("g").attr("class","y axis");k.attr({width:e,height:f});J=k.select("g").attr("transform","translate("+d.left+","+d.top+")");k=J.select(".bars").selectAll(".bar").data(g.filter(function(a){return isNaN(a[1])||0==a[1]?0:1})).enter();k.append("rect").attr("class","bar").attr("width",function(a){return w(a[1])}).attr("y",function(a){return A(a[0])}).attr("height",A.rangeBand());q&&k.append("text").attr("class","label").attr("dy",".75em").attr("y",function(a){return A(a[0])-5+A.rangeBand()/
2}).attr("x",function(a){return w(a[1])-5}).attr("text-anchor","end").text(function(a){return formatCount(a[1])});x&&k.append("text").attr("class","label").attr("dy",".75em").attr("y",function(a){return A(a[0])-5+A.rangeBand()/2}).attr("x",function(a){return 5}).attr("text-anchor","first").text(function(a){if(27<w(a[1]))return formatCount(a[3])+"x"});u&&(k.insert("line").attr("class","errorbar").attr("x1",function(a){return w(a[1])}).attr("y1",function(a){return A(a[0])+A.rangeBand()/2}).attr("x2",
function(a){return w(a[1]+a[2])}).attr("y2",function(a){return A(a[0])+A.rangeBand()/2}),k.append("line").attr("class","errorbar").attr("x1",function(a){return w(a[1]+a[2])}).attr("y1",function(a){return A(a[0])+A.rangeBand()/4}).attr("x2",function(a){return w(a[1]+a[2])}).attr("y2",function(a){return A(a[0])+A.rangeBand()/1.33}).style("visibility",function(a){return 0==a[2]?"hidden":"visible"}));"function"==typeof B&&(J.select(".x.axis").attr("transform","translate(0,"+(f-d.bottom-d.top)+")").call(B),
void 0!=typeof D&&J.select(".x.axis").append("text").attr("x",(e-d.left-d.right)/2).attr("y",d.bottom).attr("dy","-0.2em").style("text-anchor","middle").text(D));"function"==typeof I&&(J.select(".y.axis").call(I),void 0!=typeof m&&J.select(".y.axis").append("text").attr("transform","rotate(-90)").attr("x",0-(f-d.bottom-d.top)/2).attr("y",0-d.left).attr("dy","1em").style("text-anchor","middle").text(m));void 0!=typeof n&&J.append("text").attr("class","title").attr("x",(e-d.left-d.right)/2).attr("dy",
"-0.2em").style("text-anchor","middle").text(n)})}var d={top:20,right:20,bottom:40,left:90},e=515,f=300,h=["x","y"],g="sd",k="freq",l=0,p=0,q=!1,u=!1,x=!1,v,y,D,m,n,w=d3.scale.linear(),A=d3.scale.ordinal(),B=d3.svg.axis().scale(w).orient("bottom"),I=d3.svg.axis().scale(A).orient("left"),G=function(a){return a[h[0]]},H=function(a){return a[h[1]]},F=function(a){return a[g]},t=function(a){return a[k]};a.margin=function(e){if(!arguments.length)return d;d=e;return a};a.width=function(d){if(!arguments.length)return e;
e=d;return a};a.height=function(d){if(!arguments.length)return f;f=d;return a};a.mapping=function(d){if(!arguments.length)return h;h=d;return a};a.errorMapping=function(d){if(!arguments.length)return g;g=d;return a};a.freqMapping=function(d){if(!arguments.length)return k;k=d;return a};a.xDomain=function(d){if(!arguments.length)return l;l=d;return a};a.yDomain=function(d){if(!arguments.length)return p;p=d;return a};a.legend=function(d){if(!arguments.length)return legend;legend=d;return a};a.xAxis=
function(d){if(!arguments.length)return B;B=d;return a};a.yAxis=function(d){if(!arguments.length)return I;I=d;return a};a.addLabels=function(d){if(!arguments.length)return q;q=d;return a};a.addError=function(d){if(!arguments.length)return u;u=d;return a};a.addFrequencies=function(d){if(!arguments.length)return x;x=d;return a};a.xTicks=function(d){if(!arguments.length)return v;v=d;return a};a.yTicks=function(d){if(!arguments.length)return y;y=d;return a};a.xLabel=function(d){if(!arguments.length)return D;
D=d;return a};a.yLabel=function(d){if(!arguments.length)return m;m=d;return a};a.title=function(d){if(!arguments.length)return n;n=d;return a};return a}
function hgiHistogram(){function a(a){a.each(function(F){DEBUG&&(console.log("--hgiHistogram"),console.log("properties:"),console.log({margin:d,size:[e,f],mapping:h,errorMapping:g,xDomain:k,yDomain:l,addLabels:p,addError:q}),console.log("selection:"),console.log(a),console.log("data:"),console.log(F));F=sortByKey(F,"meetmoment");F=F.map(function(a,d){return q?[B.call(F,a,d),I.call(F,a,d),G.call(F,a,d)]:[B.call(F,a,d),I.call(F,a,d)]});DEBUG&&(console.log("mapped data:"),console.log(F));0==k?m.domain(F.map(function(a){return a[0]})):
m.domain(k);0==l?n.domain([0,d3.max(F,function(a){return a[1]})]):n.domain(l);m.rangeRoundBands([0,e-d.left-d.right],.2);n.range([f-d.top-d.bottom,0]);void 0!=typeof u&&w.ticks(u);void 0!=typeof x&&A.ticks(x);var t=d3.select(this).selectAll("svg").data([F]),E=t.enter().append("svg").append("g");E.append("g").attr("class","bars");E.append("g").attr("class","x axis");E.append("g").attr("class","y axis");t.attr({width:e,height:f});E=t.select("g").attr("transform","translate("+d.left+","+d.top+")");t=
E.select(".bars").selectAll(".bar").data(F.filter(function(a){return isNaN(a[1])||0==a[1]?0:1})).enter();t.append("rect").attr("class","bar").attr("x",function(a){return m(a[0])}).attr("width",m.rangeBand()).attr("y",function(a){return n(a[1])}).attr("height",function(a){return f-d.top-d.bottom-n(a[1])});p&&t.append("text").attr("class","label").attr("dy",".75em").attr("y",function(a){return 10+n(a[1])}).attr("x",function(a){return m(a[0])+m.rangeBand()/2}).attr("text-anchor","middle").text(function(a){if(22<
f-d.top-d.bottom-n(a[1]))return formatCount(a[2])});q&&(t.insert("line").attr("class","errorbar").attr("x1",function(a){return m(a[0])+m.rangeBand()/2}).attr("y1",function(a){return n(a[1])}).attr("x2",function(a){return m(a[0])+m.rangeBand()/2}).attr("y2",function(a){return n(a[1]+a[2])}),t.append("line").attr("class","errorbar").attr("x1",function(a){return m(a[0])+m.rangeBand()/4}).attr("y1",function(a){return n(a[1]+a[2])}).attr("x2",function(a){return m(a[0])+m.rangeBand()/1.33}).attr("y2",function(a){return n(a[1]+
a[2])}));"function"==typeof w&&(E.select(".x.axis").attr("transform","translate(0,"+n.range()[0]+")").call(w),D&&E.select(".x.axis").selectAll("text").attr("transform","rotate(-90)").attr("dy",".35em").attr("x",-9).attr("y",0).style("text-anchor","end"),void 0!=typeof v&&E.select(".x.axis").append("text").attr("x",(e-n.range()[0])/2).attr("y",d.bottom).attr("dy","-0.2em").style("text-anchor","middle").text(v));"function"==typeof A&&(E.select(".y.axis").call(A),void 0!=typeof v&&E.select(".y.axis").append("text").attr("transform",
"rotate(-90)").attr("x",0-(f-d.bottom-d.top)/2).attr("y",0-d.left).attr("dy","1em").style("text-anchor","middle").text(y))})}var d={top:20,right:20,bottom:40,left:50},e=515,f=300,h=["x","y"],g="sd",k=0,l=0,p=!1,q=!1,u,x,v,y,D=!1,m=d3.scale.ordinal(),n=d3.scale.linear(),w=d3.svg.axis().scale(m).orient("bottom"),A=d3.svg.axis().scale(n).orient("left"),B=function(a){return a[h[0]]},I=function(a){return a[h[1]]},G=function(a){return a[g]};a.margin=function(e){if(!arguments.length)return d;d=e;return a};
a.width=function(d){if(!arguments.length)return e;e=d;return a};a.height=function(d){if(!arguments.length)return f;f=d;return a};a.mapping=function(d){if(!arguments.length)return h;h=d;return a};a.errorMapping=function(d){if(!arguments.length)return g;g=d;return a};a.xDomain=function(d){if(!arguments.length)return k;k=d;return a};a.yDomain=function(d){if(!arguments.length)return l;l=d;return a};a.legend=function(d){if(!arguments.length)return legend;legend=d;return a};a.xAxis=function(d){if(!arguments.length)return w;
w=d;return a};a.yAxis=function(d){if(!arguments.length)return A;A=d;return a};a.addLabels=function(d){if(!arguments.length)return p;p=d;return a};a.addError=function(d){if(!arguments.length)return q;q=d;return a};a.xTicks=function(d){if(!arguments.length)return u;u=d;return a};a.yTicks=function(d){if(!arguments.length)return x;x=d;return a};a.xLabel=function(d){if(!arguments.length)return v;v=d;return a};a.yLabel=function(d){if(!arguments.length)return y;y=d;return a};a.rotateXScale=function(d){if(!arguments.length)return D;
D=d;return a};return a}
function hgiPairedHistogram(){function a(a){a.each(function(g){DEBUG&&(console.log("--hgiHistogram"),console.log("properties:"),console.log({margin:d,size:[e,f],mapping:h,xDomain:k,yDomain:l,addLabels:p,addError:q}),console.log("selection:"),console.log(a),console.log("data:"),console.log(g));g=sortByKey(g,"meetmoment");g=g.map(function(a,d){return q?[B.call(g,a,d),I.call(g,a,d),G.call(g,a,d),H.call(g,a,d),F.call(g,a,d)]:[B.call(g,a,d),I.call(g,a,d),G.call(g,a,d)]});DEBUG&&(console.log("mapped data:"),
console.log(g));0==k?m.domain(g.map(function(a){return a[0]})):m.domain(k);0==l?n.domain([0,d3.max(g,function(a){return a[1]})]):n.domain(l);m.rangeRoundBands([0,e-d.left-d.right],.2);n.range([f-d.top-d.bottom,0]);void 0!=typeof x&&w.ticks(x);void 0!=typeof v&&A.ticks(v);var C=d3.select(this).selectAll("svg").data([g]),z=C.enter().append("svg").append("g");z.append("g").attr("class","bars");z.append("g").attr("class","x axis");z.append("g").attr("class","y axis");z.append("g").attr("class","legend");
C.attr({width:e,height:f});z=C.select("g").attr("transform","translate("+d.left+","+d.top+")");C=z.select(".bars").selectAll(".bar").data(g.filter(function(a){return isNaN(a[1])||0==a[1]?0:1})).enter();C.append("rect").attr("class","bar1").attr("x",function(a){return m(a[0])}).attr("width",m.rangeBand()/2).attr("y",function(a){return n(a[1])}).attr("height",function(a){return f-d.top-d.bottom-n(a[1])});q&&(C.insert("line").attr("class","errorbar").attr("x1",function(a){return m(a[0])+m.rangeBand()/
4}).attr("y1",function(a){return n(a[1])}).attr("x2",function(a){return m(a[0])+m.rangeBand()/4}).attr("y2",function(a){return n(a[1]+a[3])}),C.append("line").attr("class","errorbar").attr("x1",function(a){return m(a[0])+m.rangeBand()/8}).attr("y1",function(a){return n(a[1]+a[3])}).attr("x2",function(a){return m(a[0])+m.rangeBand()/2.67}).attr("y2",function(a){return n(a[1]+a[3])}));p&&C.append("text").attr("class","label").attr("dy",".75em").attr("y",function(a){return 10+n(a[1])}).attr("x",function(a){return m(a[0])+
m.rangeBand()/4}).attr("text-anchor","middle").text(function(a){if(22<f-d.top-d.bottom-n(a[1]))return formatCount(a[1])});C.append("rect").attr("class","bar2").attr("x",function(a){return m(a[0])+m.rangeBand()/2}).attr("width",m.rangeBand()/2).attr("y",function(a){return n(a[2])}).attr("height",function(a){return f-d.top-d.bottom-n(a[2])});q&&(C.insert("line").attr("class","errorbar").attr("x1",function(a){return m(a[0])+m.rangeBand()/1.33}).attr("y1",function(a){return n(a[2])}).attr("x2",function(a){return m(a[0])+
m.rangeBand()/1.33}).attr("y2",function(a){return n(a[2]+a[4])}),C.append("line").attr("class","errorbar").attr("x1",function(a){return m(a[0])+m.rangeBand()/1.6}).attr("y1",function(a){return n(a[2]+a[4])}).attr("x2",function(a){return m(a[0])+m.rangeBand()/1.14}).attr("y2",function(a){return n(a[2]+a[4])}));p&&C.append("text").attr("class","label").attr("dy",".75em").attr("y",function(a){return 10+n(a[2])}).attr("x",function(a){return m(a[0])+m.rangeBand()/1.33}).attr("text-anchor","middle").text(function(a){if(22<
f-d.top-d.bottom-n(a[2]))return formatCount(a[2])});"function"==typeof w&&(z.select(".x.axis").attr("transform","translate(0,"+n.range()[0]+")").call(w),void 0!=typeof y&&z.select(".x.axis").append("text").attr("x",(e-n.range()[0])/2).attr("y",d.bottom).attr("dy","-0.2em").style("text-anchor","middle").text(y));"function"==typeof A&&(z.select(".y.axis").call(A),void 0!=typeof D&&z.select(".y.axis").append("text").attr("transform","rotate(-90)").attr("x",0-(f-d.bottom-d.top)/2).attr("y",0-d.left).attr("dy",
"1em").style("text-anchor","middle").text(D));z.select(".legend").attr("transform","translate("+(e-d.right-d.left)+","+(5+d.top)+")");z.select(".legend").append("circle").attr("class","legend1").attr("cx","-.8em").attr("cy","-.35em").attr("r",".4em");z.select(".legend").append("circle").attr("class","legend2").attr("cx","-.8em").attr("cy","1.65em").attr("r",".4em");z.select(".legend").append("text").attr("class","legend1").text(u[0]);z.select(".legend").append("text").attr("class","legend2").attr("dy",
"1.8em").text(u[1])})}var d={top:20,right:90,bottom:40,left:50},e=515,f=300,h=["x","y1","y2"],g=["sd1","sd2"],k=0,l=0,p=!1,q=!1,u=["Bar one","Bar two"],x,v,y,D,m=d3.scale.ordinal(),n=d3.scale.linear(),w=d3.svg.axis().scale(m).orient("bottom"),A=d3.svg.axis().scale(n).orient("left"),B=function(a){return a[h[0]]},I=function(a){return a[h[1]]},G=function(a){return a[h[2]]},H=function(a){return a[g[0]]},F=function(a){return a[g[1]]};a.margin=function(e){if(!arguments.length)return d;d=e;return a};a.width=
function(d){if(!arguments.length)return e;e=d;return a};a.height=function(d){if(!arguments.length)return f;f=d;return a};a.mapping=function(d){if(!arguments.length)return h;h=d;return a};a.errorMapping=function(d){if(!arguments.length)return g;g=d;return a};a.xDomain=function(d){if(!arguments.length)return k;k=d;return a};a.yDomain=function(d){if(!arguments.length)return l;l=d;return a};a.legend=function(d){if(!arguments.length)return u;u=d;return a};a.xAxis=function(d){if(!arguments.length)return w;
w=d;return a};a.yAxis=function(d){if(!arguments.length)return A;A=d;return a};a.addLabels=function(d){if(!arguments.length)return p;p=d;return a};a.addLegend=function(d){if(!arguments.length)return p;p=d;return a};a.addError=function(d){if(!arguments.length)return q;q=d;return a};a.xTicks=function(d){if(!arguments.length)return x;x=d;return a};a.yTicks=function(d){if(!arguments.length)return v;v=d;return a};a.xLabel=function(d){if(!arguments.length)return y;y=d;return a};a.yLabel=function(d){if(!arguments.length)return D;
D=d;return a};return a}
function hgiLine(){function a(a){a.each(function(t){DEBUG&&(console.log("--hgiLine"),console.log("properties:"),console.log({margin:d,size:[e,f],mapping:h,legend:l,xDomain:g,yDomain:k}),console.log("selection:"),console.log(a),console.log("data:"),console.log(t));t=sortByKey(t,"meetmoment");t=t.map(function(a,d){return[I.call(t,a,d),G.call(t,a,d),H.call(t,a,d)]});DEBUG&&(console.log("mapped data:"),console.log(t));0==g?m.domain([0,d3.max(t,function(a){return a[0]})]):m.domain(g);0==k?n.domain([0,
d3.max(t,function(a){return a[1]})]):n.domain(k);m.range([0,e-d.left-d.right]);n.range([f-d.top-d.bottom,0]);void 0!=typeof p&&w.ticks(p);void 0!=typeof q&&A.ticks(q);var E=d3.select(this).selectAll("svg").data([t]),C=E.enter().append("svg").append("g");C.append("g").attr("class","y1").append("path").attr("class","y1 line");C.append("g").attr("class","y2").append("path").attr("class","y2 line");C.append("g").attr("class","x axis");C.append("g").attr("class","y axis");E.attr({width:e,height:f});C=
E.select("g").attr("transform","translate("+d.left+","+d.top+")");if(v){DEBUG&&console.log("Vertical indicator");var z=C.append("line").attr({x1:0,y1:0,x2:0,y2:f-d.top-d.bottom+5}).attr("class","verticalLine").style("display","none")}C.select(".y1.line").attr("d",B);C.select(".y2.line").attr("d",y2Line);"function"==typeof w&&(C.select(".x.axis").attr("transform","translate(0,"+n.range()[0]+")").call(w),void 0!=typeof u&&C.select(".x.axis").append("text").attr("x",(e-d.left-d.right)/2).attr("y",d.bottom).attr("dy",
"-0.2em").style("text-anchor","middle").text(u));"function"==typeof A&&(C.select(".y.axis").call(A),void 0!=typeof u&&C.select(".y.axis").append("text").attr("transform","rotate(-90)").attr("x",0-(f-d.bottom-d.top)/2).attr("y",0-d.left).attr("dy","1em").style("text-anchor","middle").text(x));0!=l&&(E=n(t[t.length-1][1])-n(t[t.length-1][2]),14>Math.abs(E)?offsetYPos=(14-Math.abs(E))/2:offsetYPos=0,n(t[t.length-1][1])<n(t[t.length-1][2])||(offsetYPos=-offsetYPos),DEBUG&&(console.log(E),console.log(offsetYPos)),
C.select("g.y1").append("text").attr("transform","translate("+m(t[t.length-1][0])+","+(n(t[t.length-1][1])-offsetYPos)+")").attr("dy",".35em").attr("x","6").text(l[0]),C.select("g.y2").append("text").attr("transform","translate("+m(t[t.length-1][0])+","+(n(t[t.length-1][2])+offsetYPos)+")").attr("dy",".35em").attr("x","6").text(l[1]));C.selectAll("g.y1.dot").data(t.filter(function(a){return isNaN(a[1])?0:a[1]})).enter().append("circle").attr("class","dot1").attr("cx",B.x()).attr("cy",B.y()).attr("r",
2.5);C.selectAll("g.y2.dot").data(t.filter(function(a){return isNaN(a[2])?0:a[2]})).enter().append("circle").attr("class","dot2").attr("cx",y2Line.x()).attr("cy",y2Line.y()).attr("r",2.5);if(v){var E=C.append("rect").attr({"class":"overlay",width:e-d.right-d.left,height:f-d.top-d.bottom}),J=C.append("rect").attr("class","verticalLineBGLabel").attr({width:30,height:15,y:f-d.top-d.bottom+7}).style("display","none"),Q=C.append("text").attr("class","verticalLine").attr("y",f-d.top-d.bottom+19).attr("text-anchor",
"middle").style("display","none").text("test");E.on("mouseover",function(){z.style("display",null);Q.style("display",null);J.style("display",null)});E.on("mouseout",function(){z.style("display","none");Q.style("display","none");J.style("display","none");C.selectAll("circle").classed("hover",0)});E.on("mousemove",function(){var a=m.invert((d3.mouse(this)[0]+D)/y),d=d3.bisector(function(a){return a[0]}).left,e=d(t,a,1),d=t[e-1],e=t[e],g=a-d[0]>e[0]-a?e:d;C.select(".verticalLine").attr("transform",function(){return"translate("+
m(g[0])+",0)"});C.selectAll("circle").classed("hover",function(a){return a[0]==g[0]});Q.text(g[0]).attr("transform",function(){return"translate("+m(g[0])+",0)"});J.attr("transform",function(){return"translate("+(m(g[0])-15)+",0)"});DEBUG&&console.log(g)})}})}var d={top:20,right:120,bottom:40,left:50},e=515,f=300,h=["x","y1","y2"],g=0,k=0,l=0,p,q,u,x,v=!0,y=1,D=0,m=d3.scale.linear(),n=d3.scale.linear(),w=d3.svg.axis().scale(m).orient("bottom"),A=d3.svg.axis().scale(n).orient("left"),B=d3.svg.line().x(function(a){return m(a[0])}).y(function(a){return n(a[1])}).defined(function(a){return!(isNaN(a[1])||
null==a[1])}).interpolate("cardinal");y2Line=d3.svg.line().x(function(a){return m(a[0])}).y(function(a){return n(a[2])}).defined(function(a){return!(isNaN(a[2])||null==a[2])}).interpolate("cardinal");var I=function(a){return a[h[0]]},G=function(a){return a[h[1]]},H=function(a){return a[h[2]]};a.margin=function(e){if(!arguments.length)return d;d=e;return a};a.width=function(d){if(!arguments.length)return e;e=d;return a};a.height=function(d){if(!arguments.length)return f;f=d;return a};a.mapping=function(d){if(!arguments.length)return h;
h=d;return a};a.xDomain=function(d){if(!arguments.length)return g;g=d;return a};a.yDomain=function(d){if(!arguments.length)return k;k=d;return a};a.legend=function(d){if(!arguments.length)return l;l=d;return a};a.xAxis=function(d){if(!arguments.length)return w;w=d;return a};a.yAxis=function(d){if(!arguments.length)return A;A=d;return a};a.y1Line=function(d){if(!arguments.length)return B;B=d;return a};a.y2Line=function(d){if(!arguments.length)return y2Line;y2Line=d;return a};a.xTicks=function(d){if(!arguments.length)return p;
p=d;return a};a.yTicks=function(d){if(!arguments.length)return q;q=d;return a};a.xLabel=function(d){if(!arguments.length)return u;u=d;return a};a.yLabel=function(d){if(!arguments.length)return x;x=d;return a};a.addVerticalIndicator=function(d){if(!arguments.length)return v;v=d;return a};a.overlayOffset=function(d){if(!arguments.length)return D;D=d;return a};a.overlayScale=function(d){if(!arguments.length)return y;y=d;return a};return a};var data=[],freq_waar_was_ik={},freq_wat_deed_ik={},freq_dagdeel={Ochtend:0,Middag:0,Avond:0},freq_bijzonder={"Nee, niets":0,"Ja, iets positiefs":0,"Ja, iets neutraals":0,"Ja, iets negatiefs":0},freq_gezelschap={},freq_drukte={"Veel te druk":0,"Lekker druk":0,Neutraal:0,"Lekker rustig":0,"Veel te rustig":0},freq_slaapduur={},means_beweging={Ochtend:0,Middag:0,Avond:0},means_plezierigheid_activiteit={},means_eigenwaarde={},means_vanslag={"Nee, niets":0,"Ja, iets positiefs":0,"Ja, iets neutraals":0,
"Ja, iets negatiefs":0},means_opgewektheid={"Veel te druk":0,"Lekker druk":0,Neutraal:0,"Lekker rustig":0,"Veel te rustig":0},means_tekort_schieten={"Veel te druk":0,"Lekker druk":0,Neutraal:0,"Lekker rustig":0,"Veel te rustig":0},means_opgewektheid_dagritme={Ochtend:0,Middag:0,Avond:0},means_ontspanning_dagritme={Ochtend:0,Middag:0,Avond:0},means_somberheid_dagritme={Ochtend:0,Middag:0,Avond:0},means_onrust_dagritme={Ochtend:0,Middag:0,Avond:0},sd_beweging={},sd_vanslag={},sd_opgewektheid={},sd_tekort_schieten=
{},sd_opgewektheid_dagritme={},sd_ontspanning_dagritme={},sd_somberheid_dagritme={},sd_onrust_dagritme={},data_waar_was_ik=[],data_wat_deed_ik=[],data_slaapduur=[],data_gezelschap=[],data_plezierigheid_activiteit=[],data_eigenwaarde=[],data_beweging=[],data_vanslag=[],data_opgewektheid=[],data_tekort_schieten=[],data_positief_dagritme=[],data_negatief_dagritme=[];
function calculate_data(a){data=null!=a?a:DiaryDataCacher.get_basic_outcome();if(null!==data&&void 0!==data){freq_waar_was_ik={};freq_wat_deed_ik={};freq_dagdeel={Ochtend:0,Middag:0,Avond:0};freq_bijzonder={"Nee, niets":0,"Ja, iets positiefs":0,"Ja, iets neutraals":0,"Ja, iets negatiefs":0};freq_gezelschap={};freq_drukte={"Veel te druk":0,"Lekker druk":0,Neutraal:0,"Lekker rustig":0,"Veel te rustig":0};freq_slaapduur={};means_beweging={Ochtend:0,Middag:0,Avond:0};means_plezierigheid_activiteit={};
means_eigenwaarde={};means_vanslag={"Nee, niets":0,"Ja, iets positiefs":0,"Ja, iets neutraals":0,"Ja, iets negatiefs":0};means_opgewektheid={"Veel te druk":0,"Lekker druk":0,Neutraal:0,"Lekker rustig":0,"Veel te rustig":0};means_tekort_schieten={"Veel te druk":0,"Lekker druk":0,Neutraal:0,"Lekker rustig":0,"Veel te rustig":0};means_opgewektheid_dagritme={Ochtend:0,Middag:0,Avond:0};means_ontspanning_dagritme={Ochtend:0,Middag:0,Avond:0};means_somberheid_dagritme={Ochtend:0,Middag:0,Avond:0};means_onrust_dagritme=
{Ochtend:0,Middag:0,Avond:0};sd_beweging={};sd_vanslag={};sd_opgewektheid={};sd_tekort_schieten={};sd_opgewektheid_dagritme={};sd_ontspanning_dagritme={};sd_somberheid_dagritme={};sd_onrust_dagritme={};data_waar_was_ik=[];data_wat_deed_ik=[];data_slaapduur=[];data_gezelschap=[];data_plezierigheid_activiteit=[];data_eigenwaarde=[];data_beweging=[];data_vanslag=[];data_opgewektheid=[];data_tekort_schieten=[];data_positief_dagritme=[];data_negatief_dagritme=[];data.forEach(function(a){null==a.waar_was_ik?
0:void 0==freq_waar_was_ik[a.waar_was_ik]?freq_waar_was_ik[a.waar_was_ik]=1:freq_waar_was_ik[a.waar_was_ik]+=1;null==a.wat_deed_ik?0:void 0==freq_wat_deed_ik[a.wat_deed_ik]?freq_wat_deed_ik[a.wat_deed_ik]=1:freq_wat_deed_ik[a.wat_deed_ik]+=1;null==a.dagdeel?0:void 0==freq_dagdeel[a.dagdeel]?freq_dagdeel[a.dagdeel]=1:freq_dagdeel[a.dagdeel]+=1;null==a.is_er_iets_bijzonders_gebeurd?0:void 0==freq_bijzonder[a.is_er_iets_bijzonders_gebeurd]?freq_bijzonder[a.is_er_iets_bijzonders_gebeurd]=1:freq_bijzonder[a.is_er_iets_bijzonders_gebeurd]+=
1;null==a.ik_was_het_afgelopen_dagdeel_grotendeels?0:void 0==freq_gezelschap[a.ik_was_het_afgelopen_dagdeel_grotendeels]?freq_gezelschap[a.ik_was_het_afgelopen_dagdeel_grotendeels]=1:freq_gezelschap[a.ik_was_het_afgelopen_dagdeel_grotendeels]+=1;null==a.drukte?0:void 0==freq_drukte[a.drukte]?freq_drukte[a.drukte]=1:freq_drukte[a.drukte]+=1;null==a.slaapduur?0:void 0==freq_slaapduur[a.slaapduur]?freq_slaapduur[a.slaapduur]=1:freq_slaapduur[a.slaapduur]+=1;null==a.plezierigheid_activiteit?0:void 0==
means_plezierigheid_activiteit[a.wat_deed_ik]?means_plezierigheid_activiteit[a.wat_deed_ik]=+a.plezierigheid_activiteit:means_plezierigheid_activiteit[a.wat_deed_ik]+=+a.plezierigheid_activiteit;null==a.eigenwaarde?0:void 0==means_eigenwaarde[a.waar_was_ik]?means_eigenwaarde[a.waar_was_ik]=+a.eigenwaarde:means_eigenwaarde[a.waar_was_ik]+=+a.eigenwaarde;null==a.beweging?0:void 0==means_beweging[a.dagdeel]?means_beweging[a.dagdeel]=+a.beweging:means_beweging[a.dagdeel]+=+a.beweging;null==a.ik_ben_van_slag?
0:void 0==means_vanslag[a.is_er_iets_bijzonders_gebeurd]?means_vanslag[a.is_er_iets_bijzonders_gebeurd]=+a.ik_ben_van_slag:means_vanslag[a.is_er_iets_bijzonders_gebeurd]+=+a.ik_ben_van_slag;null==a.opgewektheid?0:void 0==means_opgewektheid[a.drukte]?means_opgewektheid[a.drukte]=+a.opgewektheid:means_opgewektheid[a.drukte]+=+a.opgewektheid;null==a.tekortschieten?0:void 0==means_tekort_schieten[a.drukte]?means_tekort_schieten[a.drukte]=+a.tekortschieten:means_tekort_schieten[a.drukte]+=+a.tekortschieten;
null==a.opgewektheid?0:void 0==means_opgewektheid_dagritme[a.dagdeel]?means_opgewektheid_dagritme[a.dagdeel]=+a.opgewektheid:means_opgewektheid_dagritme[a.dagdeel]+=+a.opgewektheid;null==a.ontspanning?0:void 0==means_ontspanning_dagritme[a.dagdeel]?means_ontspanning_dagritme[a.dagdeel]=+a.ontspanning:means_ontspanning_dagritme[a.dagdeel]+=+a.ontspanning;null==a.somberheid?0:void 0==means_somberheid_dagritme[a.dagdeel]?means_somberheid_dagritme[a.dagdeel]=+a.somberheid:means_somberheid_dagritme[a.dagdeel]+=
+a.somberheid;null==a.onrust?0:void 0==means_onrust_dagritme[a.dagdeel]?means_onrust_dagritme[a.dagdeel]=+a.onrust:means_onrust_dagritme[a.dagdeel]+=+a.onrust});for(var d in means_beweging)means_beweging[d]/=freq_dagdeel[d];for(d in means_vanslag)means_vanslag[d]/=freq_bijzonder[d];for(d in means_opgewektheid)means_opgewektheid[d]/=freq_drukte[d];for(d in means_tekort_schieten)means_tekort_schieten[d]/=freq_drukte[d];for(d in means_opgewektheid_dagritme)means_opgewektheid_dagritme[d]/=freq_dagdeel[d];
for(d in means_ontspanning_dagritme)means_ontspanning_dagritme[d]/=freq_dagdeel[d];for(d in means_somberheid_dagritme)means_somberheid_dagritme[d]/=freq_dagdeel[d];for(d in means_onrust_dagritme)means_onrust_dagritme[d]/=freq_dagdeel[d];data.forEach(function(a){null==a.beweging?0:void 0==sd_beweging[a.dagdeel]?sd_beweging[a.dagdeel]=Math.pow(+a.beweging-means_beweging[a.dagdeel],2):sd_beweging[a.dagdeel]+=Math.pow(+a.beweging-means_beweging[a.dagdeel],2);null==a.ik_ben_van_slag?0:void 0==sd_vanslag[a.is_er_iets_bijzonders_gebeurd]?
sd_vanslag[a.is_er_iets_bijzonders_gebeurd]=Math.pow(+a.ik_ben_van_slag-means_vanslag[a.is_er_iets_bijzonders_gebeurd],2):sd_vanslag[a.is_er_iets_bijzonders_gebeurd]+=Math.pow(+a.ik_ben_van_slag-means_vanslag[a.is_er_iets_bijzonders_gebeurd],2);null==a.opgewektheid?0:void 0==sd_opgewektheid[a.drukte]?sd_opgewektheid[a.drukte]=Math.pow(+a.opgewektheid-means_opgewektheid[a.drukte],2):sd_opgewektheid[a.drukte]+=Math.pow(+a.opgewektheid-means_opgewektheid[a.drukte],2);null==a.tekortschieten?0:void 0==
sd_tekort_schieten[a.drukte]?sd_tekort_schieten[a.drukte]=Math.pow(+a.tekortschieten-means_tekort_schieten[a.drukte],2):sd_tekort_schieten[a.drukte]+=Math.pow(+a.tekortschieten-means_tekort_schieten[a.drukte],2);null==a.opgewektheid?0:void 0==sd_opgewektheid_dagritme[a.dagdeel]?sd_opgewektheid_dagritme[a.dagdeel]=Math.pow(+a.opgewektheid-means_opgewektheid_dagritme[a.dagdeel],2):sd_opgewektheid_dagritme[a.dagdeel]+=Math.pow(+a.opgewektheid-means_opgewektheid_dagritme[a.dagdeel],2);null==a.ontspanning?
0:void 0==sd_ontspanning_dagritme[a.dagdeel]?sd_ontspanning_dagritme[a.dagdeel]=Math.pow(+a.ontspanning-means_ontspanning_dagritme[a.dagdeel],2):sd_ontspanning_dagritme[a.dagdeel]+=Math.pow(+a.ontspanning-means_ontspanning_dagritme[a.dagdeel],2);null==a.somberheid?0:void 0==sd_somberheid_dagritme[a.dagdeel]?sd_somberheid_dagritme[a.dagdeel]=Math.pow(+a.somberheid-means_somberheid_dagritme[a.dagdeel],2):sd_somberheid_dagritme[a.dagdeel]+=Math.pow(+a.somberheid-means_somberheid_dagritme[a.dagdeel],
2);null==a.onrust?0:void 0==sd_onrust_dagritme[a.dagdeel]?sd_onrust_dagritme[a.dagdeel]=Math.pow(+a.onrust-means_onrust_dagritme[a.dagdeel],2):sd_onrust_dagritme[a.dagdeel]+=Math.pow(+a.onrust-means_onrust_dagritme[a.dagdeel],2)});for(var e in sd_beweging)sd_beweging[e]=Math.sqrt(sd_beweging[e]/freq_dagdeel[e]);for(e in sd_vanslag)sd_vanslag[e]=Math.sqrt(sd_vanslag[e]/freq_bijzonder[e]);for(e in sd_opgewektheid)sd_opgewektheid[e]=Math.sqrt(sd_opgewektheid[e]/freq_drukte[e]);for(e in sd_tekort_schieten)sd_tekort_schieten[e]=
Math.sqrt(sd_tekort_schieten[e]/freq_drukte[e]);for(e in sd_opgewektheid_dagritme)sd_opgewektheid_dagritme[e]=Math.sqrt(sd_opgewektheid_dagritme[e]/freq_dagdeel[e]);for(e in sd_ontspanning_dagritme)sd_ontspanning_dagritme[e]=Math.sqrt(sd_ontspanning_dagritme[e]/freq_dagdeel[e]);for(e in sd_somberheid_dagritme)sd_somberheid_dagritme[e]=Math.sqrt(sd_somberheid_dagritme[e]/freq_dagdeel[e]);for(e in sd_onrust_dagritme)sd_onrust_dagritme[e]=Math.sqrt(sd_onrust_dagritme[e]/freq_dagdeel[e]);for(var f in freq_waar_was_ik)data_waar_was_ik.push({name:f,
value:freq_waar_was_ik[f]});for(f in freq_wat_deed_ik)data_wat_deed_ik.push({name:f,value:freq_wat_deed_ik[f]});for(f in freq_slaapduur)data_slaapduur.push({name:f,value:freq_slaapduur[f]});for(f in freq_gezelschap)data_gezelschap.push({name:f,value:freq_gezelschap[f]});for(d in means_plezierigheid_activiteit)means_plezierigheid_activiteit[d]/=freq_wat_deed_ik[d],data_plezierigheid_activiteit.push({activiteit:d,plezier:means_plezierigheid_activiteit[d],frequency:Math.log(freq_wat_deed_ik[d])});for(d in means_eigenwaarde)means_eigenwaarde[d]/=
freq_waar_was_ik[d],data_eigenwaarde.push({name:d,value:means_eigenwaarde[d],frequency:Math.log(freq_waar_was_ik[d])});for(var h in means_beweging)data_beweging.push({name:h,value:means_beweging[h],frequency:freq_dagdeel[h],sd:sd_beweging[h]});for(d in means_vanslag)data_vanslag.push({name:d,value:means_vanslag[d],frequency:freq_bijzonder[d],sd:sd_vanslag[d]});for(d in means_opgewektheid)data_opgewektheid.push({name:d,value:means_opgewektheid[d],frequency:freq_drukte[d],sd:sd_opgewektheid[d]});for(d in means_tekort_schieten)data_tekort_schieten.push({name:d,
value:means_tekort_schieten[d],frequency:freq_drukte[d],sd:sd_tekort_schieten[d]});for(d in means_opgewektheid_dagritme)data_positief_dagritme.push({name:d,opgewektheid:means_opgewektheid_dagritme[d],ontspanning:means_ontspanning_dagritme[d],frequency:freq_dagdeel[d],sd_opgewektheid:sd_opgewektheid_dagritme[d],sd_ontspanning:sd_ontspanning_dagritme[d]});for(d in means_somberheid_dagritme)data_negatief_dagritme.push({name:d,somberheid:means_somberheid_dagritme[d],onrust:means_onrust_dagritme[d],frequency:freq_dagdeel[d],
sd_somberheid:sd_somberheid_dagritme[d],sd_onrust:sd_onrust_dagritme[d]})}}function render_pieWaar(){var a=hgiPie().mapping(["name","value"]);d3.select("#pieWaar").datum(data_waar_was_ik).call(a)}function render_pieWat(){var a=hgiPie().mapping(["name","value"]);d3.select("#pieWat").datum(data_wat_deed_ik).call(a)}
function render_bubbleActiviteit(){var a=hgiBubble().mapping(["plezier","activiteit"]).weightMapping("frequency").xDomain([0,100]).orderBubbles(!0).yAxis(!1).xLabel("Plezierigheid activiteit");d3.select("#bubbleActiviteit").datum(data_plezierigheid_activiteit).call(a)}
function render_linePositief(){var a=hgiLine().mapping(["meetmoment","opgewektheid","ontspanning"]).yDomain([0,100]).legend(["Opgewektheid","Ontspanning"]).yTicks(5).xLabel("Meetmoment").yLabel("Positieve gevoelens");d3.select("#linePositief").datum(data).call(a)}
function render_lineNegatief(){var a=hgiLine().mapping(["meetmoment","somberheid","onrust"]).yDomain([0,100]).legend(["Somberheid","Onrust"]).yTicks(5).xLabel("Meetmoment").yLabel("Negatieve gevoelens");d3.select("#lineNegatief").datum(data).call(a)}
function render_pairedPositief(){var a=hgiPairedHistogram().mapping(["name","opgewektheid","ontspanning"]).errorMapping(["sd_opgewektheid","sd_ontspanning"]).yDomain([0,100]).addLabels(!1).addError(!0).yTicks(5).legend(["Opgewektheid","Ontspanning"]);d3.select("#pairedPositief").datum(data_positief_dagritme).call(a)}
function render_pairedNegatief(){var a=hgiPairedHistogram().mapping(["name","somberheid","onrust"]).errorMapping(["sd_somberheid","sd_onrust"]).yDomain([0,100]).addLabels(!1).addError(!0).yTicks(5).legend(["Somberheid","Onrust"]);d3.select("#pairedNegatief").datum(data_negatief_dagritme).call(a)}
function render_histSlaap(){var a=hgiHistogram().height(350).margin({top:20,right:50,bottom:90,left:50}).mapping(["datum","slaapkwaliteit"]).yDomain([0,100]).rotateXScale(!0).yTicks(5).yLabel("Slaapkwaliteit");d3.select("#histSlaap").datum(data).call(a)}function render_pieSlaap(){var a=hgiPie().mapping(["name","value"]).pieColor(d3.scale.category10());d3.select("#pieSlaap").datum(data_slaapduur).call(a)}
function render_lineEigenwaarde(){var a=hgiLine().mapping(["meetmoment","piekeren","eigenwaarde"]).yDomain([0,100]).legend(["Gepieker","Eigenwaarde"]).xLabel("Meetmoment").yTicks(5);d3.select("#lineEigenwaarde").datum(data).call(a)}function render_bubbleEigenwaarde(){var a=hgiBubble().mapping(["value","name"]).weightMapping("frequency").xDomain([0,100]).orderBubbles(!0).yAxis(!1).xLabel("Eigenwaarde");d3.select("#bubbleEigenwaarde").datum(data_eigenwaarde).call(a)}
function render_pieGezelschap(){var a=hgiPie().mapping(["name","value"]);d3.select("#pieGezelschap").datum(data_gezelschap).call(a)}function render_barOpgewektheid(){var a=hgiBar().mapping(["name","value"]).errorMapping("sd").freqMapping("frequency").xDomain([0,100]).addError(!0).addFrequencies(!0).xLabel("Opgewektheid");d3.select("#barOpgewektheid").datum(data_opgewektheid).call(a)}
function render_barTekortSchieten(){var a=hgiBar().mapping(["name","value"]).errorMapping("sd").freqMapping("frequency").xDomain([0,100]).addError(!0).addFrequencies(!0).xLabel("Ik heb het gevoel tekort te schieten");d3.select("#barTekortSchieten").datum(data_tekort_schieten).call(a)}
function render_barBijzonder(){var a=hgiBar().margin({top:20,right:20,bottom:40,left:110}).mapping(["name","value"]).errorMapping("sd").freqMapping("frequency").title("Is er iets bijzonders gebeurd?").xDomain([0,100]).xLabel("Ik ben van slag").addError(!0).addFrequencies(!0);d3.select("#barBijzonder").datum(data_vanslag).call(a)}
function render_lineOngemak(){var a=hgiLine().margin({top:20,right:140,bottom:40,left:50}).mapping(["meetmoment","ik_ben_van_slag","lichamelijk_ongemak"]).yDomain([0,100]).legend(["Ik ben van slag","Lichamelijk ongemak"]).yTicks(5).xTicks(5).xLabel("Meetmoment");d3.select("#lineOngemak").datum(data).call(a)}
function render_lineBeweging(){var a=hgiLine().margin({top:20,right:100,bottom:40,left:50}).mapping(["meetmoment","beweging","buiten_zijn"]).yDomain([0,100]).legend(["Beweging","Buiten zijn"]).yTicks(5).xLabel("Meetmoment");d3.select("#lineBeweging").datum(data).call(a)}function render_barBeweging(){var a=hgiHistogram().mapping(["name","value"]).errorMapping("sd").yDomain([0,100]).addLabels(!1).addError(!0).yTicks(5).yLabel("Beweging");d3.select("#barBeweging").datum(data_beweging).call(a)}
function render_scatterSomber(){var a=hgiScatter().mapping(["beweging","somberheid"]).addLOESS(!0).xLabel("Beweging").yLabel("Somberheid").yTicks(5).xTicks(5);d3.select("#scatterSomber").datum(data).call(a)}
function render_lineHoeGaatHet(){var a=hgiLine().width(625).margin({top:20,right:130,bottom:40,left:50}).mapping(["meetmoment","uw_eigen_factor","hoe_gaat_het_met_u"]).yDomain([0,100]).legend(["Uw eigen factor","Hoe gaat het met u?"]).yTicks(5).xLabel("Meetmoment");d3.select("#lineHoeGaatHet").datum(data).call(a)}
function render_scatterHoeGaatHet(){var a=hgiScatter().mapping(["uw_eigen_factor","hoe_gaat_het_met_u"]).addLOESS(!0).xLabel("Uw eigen factor").yLabel("Hoe gaat het met u?").xTicks(5).yTicks(5);d3.select("#scatterHoeGaatHet").datum(data).call(a)}function render_scatterOnrust(){var a=hgiScatter().mapping(["uw_eigen_factor","onrust"]).addLOESS(!0).xLabel("Uw eigen factor").yLabel("Onrust").xTicks(5).yTicks(5);d3.select("#scatterOnrust").datum(data).call(a)}
function render_netGelijk(){var a=hgiNetwork().maxStrokeWidth(5).minStrokeWidth(1).linkDistance(65).linkStrength(2).doWeightedCharge(!0).gravity(.1).friction(.8);d3.select("#netGelijk").datum(data_undirectedNetwerk).call(a)}
function render_netDynamisch(a){var d=hgiNetwork().doStaticLayout(!0).maxStrokeWidth(4).minStrokeWidth(1).isDirectedGraph(!0).linkDistance(175).linkStrength(2).charge(-3E3).gravity(.3).friction(.6);void 0===a&&(a="#netDynamisch");d3.select(a).datum(data_directedNetwerk).call(d)};function ImpulseResponseCalculator(a){this.var_model=a}
ImpulseResponseCalculator.prototype.estimateVmaCoefficients=function(a){var d=[],e;for(e=0;e<this.var_model.lags;e++){var f=this.var_model.number_of_variables*e;d[e]=subsetMatrix(this.var_model.var_coefficients,f,f+this.var_model.number_of_variables)}if(2<DEBUG){console.log("printing B matrix");for(b=0;b<d.length;b++)printMatrix(d[b]);console.log("Done printing B matrix")}subsetMatrix(this.var_model.var_coefficients,this.var_model.lags*this.var_model.number_of_variables,this.var_model.lags*this.var_model.number_of_variables+
this.var_model.number_of_exogen_variables);e=[];for(var h,f=0;f<a;f++){var g=[];for(h=0;h<=f;h++)if(g[h]=this.delta(d,h),0<f-h){var k=sumMatrices(e[f-h-1]);g[h]=multiplyMatrices(g[h],k)}e.push(g)}if(3<DEBUG)for(c=0;c<e.length;c++)for(ci=0;ci<e[c].length;ci++)console.log(c+":"+ci),printMatrix(e[c][ci]);return e};
ImpulseResponseCalculator.prototype.calculateImpulseResponse=function(a,d){if(1>a.length)throw"Number of shocks should be more than one";var e=d.length;if(1>e)throw"At least one coefficient matrix is needed";0<DEBUG&&console.log("Starting calculation with "+e+" timesteps and for "+this.var_model.number_of_variables+" variables.");var f,h,g,k,l=createMatrix(0,e,this.var_model.number_of_variables,!1);createMatrix(0,this.var_model.number_of_variables,this.var_model.number_of_variables,!0);l[0]=[a[0]];
for(g=1;g<e;g++){f=makeFilledArray(this.var_model.number_of_variables,0);h=a.slice(0,g);for(k=0;k<h.length;k++){var p=multiplyMatrices([h[k]],transpose(d[g-1][k]));f=0===k?sumMatrices([[f],p]):sumMatrices([f,p])}l[g]=f}l=transpose(l);return l[0]};
ImpulseResponseCalculator.prototype.runImpulseResponseCalculation=function(a,d,e){0<DEBUG&&console.log("Running calculation for: "+a+" with "+this.var_model.lags+" lags, and doing it for "+e+" steps in the future");var f=this.var_model.var_coefficients.length;-1==a?f=createMatrix(d,f,e,!1):(f=createMatrix(0,f,e,!1),f[a]=makeFilledArray(e,d));f=transpose(f);a=this.estimateVmaCoefficients(e);a=this.calculateImpulseResponse(f,a);2<DEBUG&&(console.log("Impulse response:"),printMatrix(a));return a};
ImpulseResponseCalculator.prototype.delta=function(a,d){return d>=this.var_model.lags?createMatrix(0,a[0].length,a[0][0].length,!1):a[d]};
ImpulseResponseCalculator.prototype.bootstrappedImpulseResponseCalculation=function(a,d,e,f,h){h=1-h;var g=this.var_model,k,l,p=makeSequenceArray(1,0,g.number_of_measurements-(g.lags+1)),q,u=[],x=[],v=g.getScaledResiduals(),y,D=new Var,m=Math.max(h/2,1);h=Math.min(1-h/2,0);var n;for(n=0;n<f;n++){p=sample(p);k=[];q=[];for(l=0;l<g.lags;l++)y=g.y_values[l],k.unshift(y),q.push(y);for(y=g.lags;y<g.number_of_measurements;y++)l=g.exogen_values[y],l=g.calculateNewOutput(k,l),l=math.add(l,v[p[y-g.lags]]),
q.push(l),k.pop(),k.unshift(g.y_values[y]);u.push(q);this.var_model=D.compute(q,g.exogen_values,g.node_names,g.exogen_names,g.significant_network,g.lags);x.push(this.runImpulseResponseCalculation(a,d,e));this.var_model=g}irfs_ci_high=createMatrix(0,e,this.var_model.number_of_variables,!1);irfs_ci_low=createMatrix(0,e,this.var_model.number_of_variables,!1);x=transpose(x);for(y=0;y<x.length;y++)for(irf_at_time=transpose(x[y]),a=0;a<irf_at_time.length;a++)irfs_ci_high[y][a]=getQuantile(irf_at_time[a],
m),irfs_ci_low[y][a]=getQuantile(irf_at_time[a],h);console.log({low:irfs_ci_low,high:irfs_ci_high});return{low:irfs_ci_low,high:irfs_ci_high}};
ImpulseResponseCalculator.prototype.significantImpulseResponseCalculation=function(a,d,e,f,h){bootrstrapped_response=this.bootstrappedImpulseResponseCalculation(a,d,e,f,h);a=[];var g;for(d=0;d<this.var_model.number_of_variables;d++)for(a[d]=[],f=0;f<e;f++)h=bootrstrapped_response.high[f][d],g=bootrstrapped_response.low[f][d],h=sign(h)!==sign(g)?0:0<Math.abs(h)-Math.abs(g)?g:h,a[d].push(h);return a};var injectButtons=function(a){injectSimulationFunctionality();var d=$("#aira-buttons");d.html("");d.unbind();for(var e=0;e<a.length;e++){var f=a[e],h=$('<input class="button light button_'+f+'" name="'+f+'" type="button" value="'+variable_mapping.get_value(f)+'" id="button_'+f+'"/>');d.append(h);d.on("click",".button_"+f,{current_id:e,current_node:f},function(a){clickNode(a.data.current_node,a.data.current_id)})}d.append($('<input class="button red button_all" name="button_all" type="button" value="Shock ALL!" id="button_button_all"/>'));
d.on("click",".button_all",function(){clickNode("All",-1)});d.append($('<input class="button green button_reset" name="button_reset" type="button" value="Reset" id="button_button_reset"/>'));d.on("click",".button_reset",function(){simulation.clear()});d.append($('<input class="button dark button_optimize" name="button_optimize" type="button" value="Find optimal node" id="button_button_reset"/>'));d.on("click",".button_optimize",function(){var a=new NetEffectOptimizer({wanted_increase:view_model.get_improvement()}),
d=aira.determineBestNodeFromAll();drawTable(d);aira.createAiraNetworkJson(d);(new BubbleChartVisualization(aira,a)).render()})},drawTable=function(a){for(var d="<ol>",e=0;e<a.length;e++)d=d+"<li><strong>"+a[e].name+"</strong>: "+a[e].val+"</li>";d+="</ol>";$(".effect .content").html(d)},injectSimulationFunctionality=function(){var a=$("#simulation-buttons");a.on("click",".button_pause",function(){simulation.pause()});a.on("click",".button_play",function(){simulation.run()});a.on("click",".button_next",
function(){simulation.simulateStep(1)});a.on("click",".button_previous",function(){simulation.simulateStep(-1)})},generateSelectOptions=function(a,d,e,f){html=$(f);for(i=a;i<d;i+=e)html.append($("<option></option>").attr("value",i).text(roundToPlaces(i,2)));return html},appendSelectOptions=function(a,d){html=$(d);for(i=0;i<a.length;i++)html.append($("<option></option>").attr("value",a[i]).text(a[i]));return html},convertNumberToText=function(a){return 1>a?"very few":20<a?"alot of":{1:"one",2:"two",
3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine",11:"eleven",12:"twelve",13:"thirteen",14:"fourteen",15:"fifteen",16:"sixteen",17:"seventeen",18:"eighteen",19:"nineteen",20:"twenty"}[a]},clickNode=function(a,d){1<=DEBUG&&console.log("Impulse given on: "+a+" ("+d+")");console.log(d+" < id and name > "+a);var e=transpose(impulse_response_calculator.runImpulseResponseCalculation(d,1,view_model.get_steps())),f;view_model.get_chk_bootstrap()&&(f=view_model.get_bootstrap_iterations(),f=
impulse_response_calculator.bootstrappedImpulseResponseCalculation(d,1,view_model.get_steps(),f,.95));visualization_engine.draw(e,f);e=transpose(impulse_response_calculator.runImpulseResponseCalculation(d,1,view_model.get_steps()));e=linearInterpolation(e,view_model.get_interpolation());f=0===view_model.get_interpolation()?1:view_model.get_interpolation();simulation.setStepsToRun(view_model.get_steps()*f);simulation.setIrf(e);simulation.run(!0);-1!=d&&(e=new ThresholdOptimizer({threshold:view_model.get_threshold()}),
f=new NetEffectOptimizer({wanted_increase:view_model.get_improvement()}),$("#chk-threshold").prop("checked")&&visualization_engine.updateAdvice(aira.determineOptimalNodeSimple(d,e)),$("#chk-stability").prop("checked")&&visualization_engine.updateNetEffect(aira.determineOptimalNodeSimple(d,f),a),$("#chk-frequency").prop("checked")&&aira.determineOptimalNode(d,{degradation:[],threshold:view_model.get_threshold()}))};function JsonParser(a,d){this.data=a;this.variable_mapping=d;this.SIGNIFICANT_NETWORK_LOCATION=0;this.COMPLETE_DATA_LOCATION=3}JsonParser.prototype.hgiNetworkDataToMatrix=function(){var a,d,e,f,h;a=this.data[0].links;d=this.data[0].nodes;var g=createMatrix(0,d.length,d.length,!1);for(d=0;d<a.length;d++)e=a[d].source,f=a[d].target,h=a[d].coef,g[e][f]=parseFloat(h);return g};getHgiNetworkJsonKeys=function(a){var d=["--"],e;for(e in a)a.hasOwnProperty(e)&&d.push(e);return d};
JsonParser.prototype.nodeKeysFromJson=function(){var a=this;return this.data[this.SIGNIFICANT_NETWORK_LOCATION].nodes.map(function(d){return a.variable_mapping.get_key(d.name)})};JsonParser.prototype.exogenKeysFromJson=function(){return this.data[this.COMPLETE_DATA_LOCATION].exogen.header};JsonParser.prototype.getYDataFromJson=function(){return this.data[this.COMPLETE_DATA_LOCATION].endogen.body};JsonParser.prototype.getExogenDataFromJson=function(){return this.data[this.COMPLETE_DATA_LOCATION].exogen.body};
JsonParser.prototype.getExogenCoefficientMatrix=function(){var a=this.nodeKeysFromJson(),d=this.exogenKeysFromJson();return this.exogenCoefficientMatrix(a,d)};JsonParser.prototype.getEndogenCoefficientMatrix=function(){var a=this.nodeKeysFromJson();return this.coefficientMatrix(a)};
JsonParser.prototype.coefficientMatrix=function(a){var d,e,f,h,g,k;d=this.data[this.COMPLETE_DATA_LOCATION].coefs;var l=d.header.indexOf("Estimate"),p=d.body,q=[createMatrix(0,a.length,a.length,!1)];k=1;for(d=0;d<a.length;d++)for(h in e=a[d],g=p[e],g)if(g.hasOwnProperty(h)&&(f=h.split("."),!(0===f.length||0>a.indexOf(f[0])))){for(e=parseInt(f[1].substring(1));e>k;)q.push(createMatrix(0,a.length,a.length,!1)),k++;f=a.indexOf(f[0]);q[e-1][d][f]=g[h][l]}return q};
JsonParser.prototype.exogenCoefficientMatrix=function(a,d){var e,f,h;e=this.data[this.COMPLETE_DATA_LOCATION].coefs;var g=e.header.indexOf("Estimate"),k=e.body,l=createMatrix(0,a.length,d.length,!1);for(e=0;e<a.length;e++)for(f in h=a[e],h=k[h],h)!h.hasOwnProperty(f)||0>d.indexOf(f)||(l[e][d.indexOf(f)]=h[f][g]);return l};JsonParser.prototype.getSignificantNetworkFromJson=function(){return this.data[this.SIGNIFICANT_NETWORK_LOCATION]};var multiplyMatrices=function(a,d){if(is_scalar(a))return d.map(function(d){return d.map(function(d){return d*a})});var e=transpose(d);return a.map(function(a){return e.map(function(d){return d.reduce(function(d,e,h){return d+e*a[h]},0)})})},kroneckerProduct=function(a,d){dimensions_first=dimensions(a);dimensions_second=dimensions(d);size=pairWiseProduct(dimensions_first,dimensions_second);result=createMatrix(0,size[0],size[1],!1);a.forEach(function(a,f){a.forEach(function(a,e){multiplyMatrices(a,
d).forEach(function(a,d){a.forEach(function(a,h){r=f*(dimensions_first[0]-1)+d;c=e*(dimensions_first[1]-1)+h;result[r][c]=a})})})});return result},pairWiseProduct=function(a,d){for(var e=Array(a.length),f=0,h=a.length;f<h;f++)e[f]=a[f]*d[f];return e},is_scalar=function(a){return/string|number|boolean/.test(typeof a)};Math.sign=Math.sign||function(a){return+a===a?0===a?a:0<a?1:-1:NaN};
var sumMatrices=function(a){var d=[],e,f,h;for(e=0;e<a[0].length;e++){var g=[];for(f=0;f<a[0][e].length;f++){var k=0;for(h=0;h<a.length;h++)k+=a[h][e][f];g.push(k)}d.push(g)}return d},mergeMatrix=function(a){a=[].concat.apply([],a);return a[0].constructor===Array?mergeMatrix(a):a},roundToPlaces=function(a,d){return((a+"").split(".")[1]||[]).length<=d?a:+(Math.round(a+"e+"+d)+"e-"+d)},calculateMean=function(a){return a.reduce(function(d,e){return d+e/a.length},0)},standardDeviation=function(a,d){void 0===
d&&(d=calculateMean(a));return Math.sqrt(a.reduce(function(a,f){return a+Math.pow(f-d,2)},0)/(a.length-1))},printMatrix=function(a){var d,e,f;console.log("-----------------");console.log("Dimensions: "+a.length+"x"+a[0].length);f="   ";for(d=0;d<a.length;d++)f+=d+", ";console.log(f.slice(0,-2));for(d=0;d<a.length;d++){f=d+": ";for(e=0;e<a[d].length;e++)f+=a[d][e]+", ";console.log(f.slice(0,-2))}console.log("-----------------");return!0},dimensions=function(a){rows=a.length;columns=a[0].length;return[rows,
columns]},transpose=function(a){return a[0].map(function(d,e){return a.map(function(d,h){return a[h][e]})})},subsetMatrix=function(a,d,e){var f=[];for(row=0;row<a.length;row++)f.push(a[row].slice(d,e));return f},createMatrix=function(a,d,e,f){if(f&&d!=e)throw Error("Identity matrices should be square");var h=Array(d);a=f?0:a;for(var g=0;g<d;g++)h[g]=makeFilledArray(e,a),f&&(h[g][g]=1);return h},linearInterpolation=function(a,d){var e,f,h,g,k,l,p=[];if(1>=d)return a;for(f=0;f<a.length;f++){g=a[f];
l=g.length*d-(d-1);k=[];for(h=0;h<g.length;h++)if(k[h*d]=g[h],l>h*d+1){var q=(g[h+1]-g[h])/d;for(e=0;e<d;e++)k.push(g[h]+q*e)}p.push(k)}return p},makeFilledArray=function(a,d){for(var e=[];0<a--;)e.push(d);return e},makeSequenceArray=function(a,d,e){var f=[];index=0;for(value=d;value<=e;value+=a)f[index]=roundToPlaces(value,3),index++;return f},addPadding=function(a,d,e){if(a.length<=d)return makeFilledArray(a.length,0);a=a.slice(0,a.length-d);return makeFilledArray(d,e).concat(a)},discreteDerivative=
function(a){var d=a.slice(1,a.length);d.push(0);return a.map(function(a,f){return d[f]-a})},findMinimumInRange=function(a,d,e){a=a.slice(d,e);return findMinimum(a)},findMinimum=function(a){return Math.min.apply(null,a)},selectionFromArray=function(a,d){return d.map(function(d,f){return a[d]})},findAllValleys=function(a){a=discreteDerivative(a);var d,e;valleys=[];for(d=0;d<a.length;d++)void 0!=e&&0<a[d]&&0>e&&valleys.push(d),e=a[d];return valleys},scaleMatrix=function(a,d){return a.map(function(a,
f){return scaleArray(a,d)})},scaleArray=function(a,d){return a.map(function(a,f){return a*d})},arraySum=function(a){if(1>a.length)throw"At least one array is needed for summation";var d,e,f,h=[];f=a[0];for(e=0;e<f.length;e++)for(h.push(0),d=0;d<a.length;d++)h[e]+=a[d][e];return h},cumulativeSummation=function(a){var d=0;return a.map(function(a,f){sum=0;return void 0!=a.length?a.map(function(a,d){return sum+=a}):d+=a})};function sign(a){return+a===a?0===a?0:0<a?1:-1:NaN}
var shuffle=function(a){return a.sort(function(){return.5-Math.random()})},sample=function(a){for(var d=[],e=0;e<a.length;e++)d.push(a[Math.floor(Math.random()*a.length)]);return d},average=function(a){return a.reduce(function(a,e){return a+e},0)/(0==a.length?1:a.length)},centerArray=function(a){var d=average(a),e=[];a.forEach(function(a){e.push(a-d)});return e},sortNumericalArray=function(a,d){return a.sort(function(a,f){return"desc"==d?f-a:a-f})},getQuantile=function(a,d){var e,f,h,g;e=(a.length-
1)*d;h=Math.floor(e);f=Math.ceil(e);sortNumericalArray(a,"asc");g=a[h];e=e>h?Math.round(1E3*(e-h))/1E3:0;return(1-e)*g+e*a[f]};var linearSearch=function(a,d){var e=0;for(a=parseFloat(a.toPrecision(14));e<d.length&&parseFloat(d[e].toPrecision(14))<a;)e++;return e},binarySearch=function(a,d){for(var e=0,f=0,h=d.length;f<=h;){e=Math.floor((h+f)/2);if(d[e]==a)return e;d[e]<a&&(f=e+1);d[e]>a&&(h=e-1)}return null};function getSortedKeys(a){var d=[],e;for(e in a)a.hasOwnProperty(e)&&d.push(e);return d.sort(function(d,e){return a[d]-a[e]})};function Simulation(a){this.node_names=a;this.default_size=20;this.size_factor=50;this.frame_rate=60;this.step=0;this.intervals=[];this.use_absolute_value=!1}Simulation.prototype.run=function(a){a&&this.clear();this.intervals.push(setInterval(function(a){return function(){a.simulateStep(1)}}(this),Math.floor(1E3/this.frame_rate)));return!0};Simulation.prototype.setIrf=function(a){this.irf=a;console.log(a)};Simulation.prototype.setStepsToRun=function(a){this.steps_to_run=a};
Simulation.prototype.simulateStep=function(a){var d=$("#shock");visualization_engine.setPlotlineLocation(this.step/this.steps_to_run*view_model.get_steps());0===this.step?d.show():d.fadeOut("slow");for(d=0;d<this.node_names.length;d++)this.plotValue(this.node_names[d],this.irf[d][this.step]*this.size_factor);this.step+=a;this.step%=this.steps_to_run};Simulation.prototype.resetNodes=function(a){for(var d in a)a.hasOwnProperty(d)&&this.plotValue(a[d],this.default_size)};
Simulation.prototype.pause=function(){for(var a=0;a<this.intervals.length;a++)clearTimeout(this.intervals[a])};Simulation.prototype.clear=function(){this.pause();this.step=0;this.resetNodes(this.node_names)};
Simulation.prototype.plotValue=function(a,d){var e=$("body");if(!this.use_absolute_value){var f=0<=d?"Positief":"Negatief";e.find("g .node").parent().find("#"+a).parent().children().first().attr("class","node "+f)}d=isNaN(d)?0:Math.abs(d);a=variable_mapping.get_network_id_from_value(variable_mapping.get_value(a));e.find("g .node").parent().find("#"+a).parent().children().attr("r",d)};var Var=function(){};
Var.prototype.compute=function(a,d,e,f,h,g){var k=a.length-g,l=a[0].length,p=transpose(a),q=createMatrix(0,l*g,k,!1),u,x,v;d=transpose(d);for(u=0;u<g;u++)for(x=0;x<l;x++)for(v=0;v<k;v++)row=x,col=v-(u+1)+g,q[l*u+x][v]=p[row][col];d[0].length===a.length&&(d=subsetMatrix(d,g,a.length));for(u=0;u<d.length;u++)q.push(d[u]);p=subsetMatrix(p,g,k+g);k=multiplyMatrices(q,transpose(q));k=math.inv(k);k=multiplyMatrices(transpose(q),k);k=multiplyMatrices(p,k);p=[];for(u=0;u<g;u++)p.push(subsetMatrix(k,u*l,l*
(u+1)));g=subsetMatrix(k,(g+1)*l,k[0].length);return new VarModel(p,g,e,f,a,d,h,!1,variable_mapping)};var VarModel=function(a,d,e,f,h,g,k,l,p){this.exogen_coefficients=d;this.lags=a.length;this.number_of_variables=e.length;this.number_of_measurements=h.length;this.node_names=e;this.exogen_names=f;this.significant_network=k;this.variable_mapping=p;this.y_values=h;this.exogen_values=g;d=[];for(e=0;e<this.lags;e++)d=d.concat(transpose(a[e]));this.var_coefficients=transpose(d);l&&this.convert_coefficients();if(1>a.length||1>a[0].length)throw"At least one parameter is needed in the VAR model";this.number_of_exogen_variables=
a[0].length-this.lags*this.number_of_variables;this.number_of_exogen_variables=0<this.number_of_exogen_variables?this.number_of_exogen_variables:0;this.data_summary=this.calculateDataSummary()};VarModel.prototype.getSignificantEdges=function(){return this.getSignificantNetwork().links};VarModel.prototype.getSignificantNetwork=function(){return this.significant_network};
VarModel.prototype.calculateNewOutput=function(a,d){if(a.length!=this.lags)throw"The endogen values should be for both lags";var e=[],f,h;for(f=0;f<a.length;f++)h=math.multiply(this.getCoefficients(f+1),a[f]),e.push(h);e=arraySum(e);return e=math.add(e,math.multiply(this.exogen_coefficients,d))};
VarModel.prototype.getResiduals=function(){for(var a=[],d,e=[],f=0;f<this.lags;f++)a.unshift(this.y_values[f]);for(f=this.lags;f<this.number_of_measurements;f++)d=this.exogen_values.length<this.number_of_measurements?this.exogen_values[f-this.lags]:this.exogen_values[f],d=this.calculateNewOutput(a,d),e.push(math.subtract(this.y_values[f],d)),a.pop(),a.unshift(this.y_values[f]);return e};
VarModel.prototype.getScaledResiduals=function(){for(var a=transpose(this.getResiduals()),d=[],e=0;e<this.number_of_variables;e++)d.push(centerArray(a[e]));return transpose(d)};VarModel.prototype.get_data_summary=function(a){return this.data_summary[a]};VarModel.prototype.calculateDataSummary=function(){for(var a,d={},e=transpose(this.y_values),f=0;f<this.node_names.length;f++){a=this.node_names[f];this.node_names.indexOf(a);var h=calculateMean(e[f]),g=standardDeviation(e[f],h);d[a]={average:h,sd:g}}return d};
VarModel.prototype.get_node_name=function(a){return this.node_names[a]};VarModel.prototype.convert_coefficients=function(){for(var a=0,d=0;d<this.lags;d++)for(var e=0;e<this.number_of_variables;e++)for(var f=0;f<this.number_of_variables;f++)a="Negatief"==this.variable_mapping.get_type(this.node_names[e])?-1:1,this.set_coefficient(d,f,e,a*this.get_coefficient(d,f,e))};
VarModel.prototype.to_json=function(){for(var a=[],d=[],e=0;e<this.lags;e++)for(var f=0;f<this.number_of_variables;f++){0===e&&d.push({index:f,name:this.variable_mapping.get_value(this.node_names[f]),type:"Positief"});for(var h=0;h<this.number_of_variables;h++)f!==h&&a.push({source:h,target:f,coef:this.get_coefficient(e,h,f)})}return{links:a,nodes:d}};VarModel.prototype.set_coefficient=function(a,d,e,f){this.var_coefficients[e][a+d]=f};
VarModel.prototype.get_coefficient=function(a,d,e){return this.var_coefficients[e][a+d]};VarModel.prototype.getCoefficients=function(a){if(a>this.lags||0>=a)throw"Number of lags not included in the model";return subsetMatrix(this.var_coefficients,this.number_of_variables*(a-1),this.number_of_variables*a)};function VariableMapping(){this.mapping={beweging:{name:"Beweging",translation:"Physical activity",type:"Positief"},buiten_zijn:{name:"Buiten zijn",translation:"Being outside",type:"Positief"},concentratie:{name:"Concentratie",translation:"Concentration",type:"Positief"},eenzaamheid:{name:"Eenzaamheid",translation:"Loneliness",type:"Negatief"},eigenwaarde:{name:"Eigenwaarde",translation:"Self-esteem",type:"Positief"},humor:{name:"Humor",translation:"Humor",type:"Positief"},iets_betekenen:{name:"Iets betekenen",
translation:"Mean something",type:"Positief"},hier_en_nu:{name:"In het hier en nu leven",translation:"Mindfulness",type:"Positief"},levenslust:{name:"Levenslust",translation:"",type:"Positief"},lichamelijk_ongemak:{name:"Lichamelijk ongemak",translation:"Physical discomfort",type:"Negatief"},uw_eigen_factor:{name:"Mijn eigen factor",translation:"Personal factor",type:"Neutraal"},onrust:{name:"Onrust",translation:"Agitation",type:"Negatief"},ontspanning:{name:"Ontspanning",translation:"Relaxation",
type:"Positief"},opgewektheid:{name:"Opgewektheid",translation:"Cheerfulness",type:"Positief"},piekeren:{name:"Piekeren",translation:"Rumination",type:"Negatief"},SomBewegUur:{name:"SomBewegUur",translation:"Activity",type:"Positief"},SomPHQ:{name:"SomPHQ",translation:"Depression",type:"Negatief"},somberheid:{name:"Somberheid",translation:"Sadness",type:"Negatief"},tekortschieten:{name:"Tekortschieten",translation:"Falling short on something",type:"Negatief"}}}
VariableMapping.prototype.get_value_from_network=function(a){if(0===a.length)return a;var d=RegExp("_","g");return a.charAt(0).toUpperCase()+a.slice(1).replace(d," ")};VariableMapping.prototype.get_network_id_from_value=function(a){if(0===a.length)return a;var d=RegExp(" ","g");return a.charAt(0).toLowerCase()+a.slice(1).replace(d,"_")};VariableMapping.prototype.get_entry=function(a){if(a.constructor===Array){var d=this.mapping;return a.map(function(a,f){return d[a]})}return this.mapping[a]};
VariableMapping.prototype.get_translation=function(a){result=this.get_entry(a);return result.constructor===Array?result.map(function(a,e){return a.translation}):result.translation};VariableMapping.prototype.get_value=function(a){result=this.get_entry(a);return result.constructor===Array?result.map(function(a,e){return a.name}):result.name};VariableMapping.prototype.get_type=function(a){if(a.constructor===Array){var d=this.mapping;return a.map(function(a,f){return d[a].type})}return this.mapping[a].type};
VariableMapping.prototype.get_keys=function(a){result=[];for(var d=0;d<a.length;d++)result.push(this.get_key(a[d]));return result};VariableMapping.prototype.get_key=function(a){for(var d=Object.keys(this.mapping),e=0,f=0,h=d.length;f<=h;){e=Math.floor((h+f)/2);if(e>=d.length)break;if(this.mapping[d[e]].name==a)return d[e];this.mapping[d[e]].name<a&&(f=e+1);this.mapping[d[e]].name>a&&(h=e-1)}};
VariableMapping.prototype.get_key_linear=function(a){for(var d in this.mapping)if(this.mapping.hasOwnProperty(d)&&this.mapping[d].name===a)return d};function ViewModel(){}ViewModel.prototype.get_steps=function(){"undefined"===typeof this.prediction&&(this.prediction=$("#prediction"));return this.prediction.val()};ViewModel.prototype.get_threshold=function(){"undefined"===typeof this.threshold&&(this.threshold=$("#threshold"));return this.threshold.val()};ViewModel.prototype.get_interpolation=function(){"undefined"===typeof this.interpolation&&(this.interpolation=$("#interpolation"));return this.interpolation.val()};
ViewModel.prototype.get_improvement=function(){"undefined"===typeof this.improvement&&(this.improvement=$("#improvement"));return this.improvement.val()};ViewModel.prototype.get_bootstrap_iterations=function(){"undefined"===typeof this.bootstrap_iterations&&(this.bootstrap_iterations=$("#bootstrap_iterations"));return this.bootstrap_iterations.val()||0};
ViewModel.prototype.get_chk_bootstrap=function(){"undefined"===typeof this.chk_bootstrap&&(this.chk_bootstrap=$("#chk-bootstrap"));return this.chk_bootstrap.prop("checked")||!1};function Visualization(a){this.node_names=a;this.chart={}}
Visualization.prototype.updateAdvice=function(a){var d=$(".aira-result").find(".advice .content"),e=0,f="<ol>",h,g,k;for(k in a)if(a.hasOwnProperty(k))for(e+=a[k].length,h=0;h<a[k].length;h++){g=a[k][h];var l=g[1]-g[0],f=f+("<li>You could increase your level of "+k+", every "+((g[1]-l)/1).toFixed(1)+" measurement moments. This has an effect that lasts for "+(l/1).toFixed(2)+" days </li>")}0<e&&(d.html("<p>If you would like to increase the variable you just clicked, you can do "+convertNumberToText(e)+
" thing"+(1==e?"":"s")+":</p>"),d.append(f+"</ol>"))};
Visualization.prototype.updateNetEffect=function(a,d){var e=0,f=$(".aira-result").find(".effect .content");f.html("");var h,g,k="<ol>",l;for(l in a)a.hasOwnProperty(l)&&(h=100*a[l].needed_difference,g=0<h?"increase":"decrease",g="<li>You could "+g+" your average amount of "+l+" with "+Math.abs(h.toFixed(0))+"%</li>",e+=1,k+=g);f.append("<p>If you would like to change the '"+variable_mapping.get_value(d)+"'-variable with "+view_model.get_improvement()+"%, you can do "+convertNumberToText(e)+" thing"+
(1==e?"":"s")+":</p>");f.append(k+"</ol>")};Visualization.prototype._addPlotLine=function(a){this.chart.xAxis[0].addPlotLine({value:a,color:"rgb(255, 0, 0)",width:1,id:"plot_line"})};Visualization.prototype._removePlotLine=function(){this.chart.xAxis[0].removePlotLine("plot_line")};Visualization.prototype.setPlotlineLocation=function(a){};Visualization.prototype.addData=function(a,d){this.chart.addSeries({name:a,data:d,visible:!1})};
Visualization.prototype.draw=function(a,d){var e,f=[],h,g;void 0!==d&&(h=transpose(d.low),g=transpose(d.high));for(e=0;e<a.length;e++)f.push({name:variable_mapping.get_translation(this.node_names[e]),data:a[e],visible:!0}),void 0!==d&&f.push({name:variable_mapping.get_translation(this.node_names[e])+" error",type:"areasplinerange",data:_.zip(h[e],g[e]),visible:!0});this.chart=new Highcharts.Chart({chart:{renderTo:"container",type:"spline"},plotOptions:{series:{marker:{enabled:!1}}},title:{text:"Impulse response graph",
x:-20},subtitle:{text:"Calculated using AIRA",x:-20},credits:{enabled:!1},xAxis:{allowDecimals:!1,minTickInterval:1,maxTickInterval:1,title:{text:"Horizon (time steps)"}},yAxis:{title:{text:"Response (Y<sub>t</sub> - d)"},plotLines:[{value:0,width:1,color:"#808080"}]},series:f})};